{"version":3,"file":"SavedWidgetItem-DRn6fR6H.js","sources":["../../src/components/SavedWidgetItem.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { onMounted, ref } from 'vue'\nimport type { DataInsightsWidget } from '@/domain/DataInsightsWidget'\nimport { createDebug } from '@/util/debug'\n\nconst debug = createDebug('saved-widget-item');\n\nconst props = defineProps<{\n  widget: DataInsightsWidget\n}>()\n\nconst emit = defineEmits<{\n  delete: [id: string]\n}>()\n\nconst previewLoaded = ref(false)\n\nconst getWidgetTitle = (): string => {\n  try {\n    const name = props.widget.dataInsightsComponent?.name || ''\n    if (name && name.length > 0) {\n      return name\n    }\n    return 'Data Insight'\n  } catch {\n    return 'Data Insight'\n  }\n}\n\nconst getWidgetSubtitle = (): string => {\n  try {\n    const description = props.widget.dataInsightsComponent?.description || ''\n    if (description && description.length > 0) {\n      return description\n    }\n    return 'Data visualization'\n  } catch {\n    return 'Data visualization'\n  }\n}\n\nconst loadEchartsIfNeeded = (): Promise<void> => {\n  return new Promise((resolve) => {\n    if ((window as any).echarts) {\n      resolve()\n      return\n    }\n    \n    if ((window as any).echartsLoading) {\n      const checkInterval = setInterval(() => {\n        if ((window as any).echarts) {\n          clearInterval(checkInterval)\n          resolve()\n        }\n      }, 100)\n      return\n    }\n    \n    ;(window as any).echartsLoading = true\n    const script = document.createElement('script')\n    script.src = 'https://cdn.jsdelivr.net/npm/echarts@5.5.1/dist/echarts.min.js'\n    script.onload = () => {\n      ;(window as any).echartsLoading = false\n      resolve()\n    }\n    script.onerror = () => {\n      ;(window as any).echartsLoading = false\n      resolve()\n    }\n    document.head.appendChild(script)\n  })\n}\n\nconst executeWidgetHTML = async () => {\n  const htmlContent = props.widget.dataInsightsComponent?.rawHtml || ''\n  \n  if (!htmlContent) return\n  \n  if (htmlContent.includes('echarts')) {\n    await loadEchartsIfNeeded()\n  }\n  \n  executeWidgetElement(htmlContent)\n}\n\nconst executeWidgetElement = (htmlContent: string) => {\n  try {\n    const elementNameMatch = htmlContent.match(/customElements\\.define\\(['\"`]([^'\"`]+)['\"`]/)\n    let elementName = elementNameMatch ? elementNameMatch[1] : null\n    \n    if (!elementName) return\n    \n    // If element already exists, create unique name for this widget instance\n    if (customElements.get(elementName)) {\n      debug('Element already registered, using existing: %s', elementName)\n      // Check if it's the same class or different\n      const existingElement = customElements.get(elementName)\n      const newClassMatch = htmlContent.match(/class\\s+(\\w+)\\s+extends\\s+HTMLElement/)\n      const newClassName = newClassMatch ? newClassMatch[1] : null\n      \n      // If different implementation, create unique element name\n      if (newClassName && existingElement && existingElement.name !== newClassName) {\n        const uniqueName = `${elementName}-${props.widget.id?.substring(0, 8)}`\n        debug('Element already registered, creating unique name: %s', uniqueName)\n        const modifiedHtml = htmlContent.replace(\n          `customElements.define('${elementName}'`,\n          `customElements.define('${uniqueName}'`\n        )\n        eval(modifiedHtml)\n        elementName = uniqueName\n      }\n      \n      createWidgetElement(elementName)\n      return\n    }\n    \n    debug('Registering new element: %s', elementName)\n    eval(htmlContent)\n    \n    setTimeout(() => {\n      if (elementName && customElements.get(elementName)) {\n        createWidgetElement(elementName)\n      }\n    }, 500)\n  } catch (error) {\n    debug('Error executing widget HTML: %O', error)\n  }\n}\n\nconst createWidgetElement = (elementName: string) => {\n  const previewContainer = document.querySelector(`[data-widget-id=\"${props.widget.id}\"] .widget-preview-content`)\n  \n  debug('Creating element for: %s, registered: %s', props.widget.dataInsightsComponent?.name, !!customElements.get(elementName))\n  \n  if (previewContainer) {\n    const element = document.createElement(elementName)\n    debug('Element created: %s', elementName)\n    previewContainer.innerHTML = ''\n    previewContainer.appendChild(element)\n    debug('Element appended to container')\n    \n    setTimeout(() => {\n      debug('Checking shadow root - exists: %s', !!element.shadowRoot)\n      \n      if (element.shadowRoot) {\n        debug('Shadow root confirmed')\n        const style = document.createElement('style')\n        element.shadowRoot.appendChild(style)\n        debug('Styles appended')\n        \n        setTimeout(() => {\n          debug('Preview loaded for: %s', props.widget.dataInsightsComponent?.name)\n          previewLoaded.value = true\n          \n          if (element.shadowRoot) {\n            const chartContainer = element.shadowRoot.querySelector('.chart-container, [id=\"chart\"]')\n            debug('Chart container in shadow: %s', !!chartContainer)\n            \n            const canvas = element.shadowRoot.querySelector('canvas')\n            const svg = element.shadowRoot.querySelector('svg')\n            debug('Canvas: %s, SVG: %s', !!canvas, !!svg)\n            \n            const chartElement = element.shadowRoot.querySelector('canvas, svg, [id=\"chart\"]') as any\n            if (chartElement && chartElement.__ec_inner__) {\n              setTimeout(() => {\n                debug('Resizing echarts')\n                chartElement.__ec_inner__.resize()\n                debug('ECharts resized')\n              }, 500)\n            } else {\n              debug('No echarts instance found (might be other chart library)')\n            }\n          }\n        }, 1000)\n      } else {\n        debug('No shadow root found!')\n      }\n    }, 300)\n  } else {\n    debug('Preview container not found for: %s', props.widget.id)\n  }\n}\n\nonMounted(() => {\n  setTimeout(() => {\n    executeWidgetHTML()\n  }, 200)\n})\n</script>\n\n<template>\n  <div\n    :data-widget-id=\"widget.id || ''\"\n    class=\"widget-card bg-white rounded-lg border border-surface-200 overflow-hidden h-[220px]\"\n  >\n    <div class=\"widget-chart-area bg-gray-50 p-2 relative\">\n      <div \n        v-if=\"!previewLoaded\"\n        class=\"widget-loading-overlay absolute inset-0 bg-white bg-opacity-90 flex items-center justify-center z-10\"\n      >\n        <div class=\"text-center\">\n          <i class=\"pi pi-spin pi-spinner text-blue-500 text-lg mb-1\"></i>\n          <div class=\"text-xs text-gray-600\">Loading...</div>\n        </div>\n      </div>\n      \n      <div class=\"widget-preview-content\" :data-widget-id=\"widget.id\">\n        <div class=\"chart-placeholder\" style=\"display: none; color: #999; font-size: 12px; text-align: center;\">\n          Loading chart...\n        </div>\n      </div>\n    </div>\n    \n    <div class=\"p-3 relative\">\n      <div class=\"font-semibold text-sm text-gray-900 mb-1 pr-6\">{{ getWidgetTitle() }}</div>\n      <div class=\"text-xs text-gray-500 line-clamp-2 pr-6\">{{ getWidgetSubtitle() }}</div>\n      \n      <button\n        @click.stop=\"emit('delete', widget.id!)\"\n        class=\"absolute top-2 right-2 text-gray-400 hover:text-red-500 transition-colors p-1\"\n        title=\"Delete Widget\"\n      >\n        <i class=\"pi pi-trash text-xs\"></i>\n      </button>\n    </div>\n  </div>\n</template>\n\n<style scoped>\n.widget-card {\n  user-select: none;\n  transition: transform 0.2s ease, box-shadow 0.2s ease;\n}\n\n.widget-card:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n}\n\n.widget-chart-area {\n  height: 150px;\n  overflow: hidden;\n  position: relative;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: #f8f9fa;\n}\n\n.widget-preview-content {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  position: relative;\n  min-height: 100px;\n  transition: opacity 0.3s ease;\n}\n\n.widget-preview-content :deep(canvas),\n.widget-preview-content :deep(svg) {\n  max-width: 100% !important;\n  max-height: 100% !important;\n  width: auto !important;\n  height: auto !important;\n  display: block !important;\n  margin: auto !important;\n}\n\n.widget-preview-content :deep(*) {\n  pointer-events: none;\n}\n\n.widget-preview-content :deep(.apexcharts-canvas),\n.widget-preview-content :deep(.apexcharts-svg),\n.widget-preview-content :deep([class*=\"apex\"]) {\n  margin: auto !important;\n  display: block !important;\n}\n\n.widget-preview-content :deep(.chart-container) {\n  height: 100% !important;\n  width: 100% !important;\n}\n\n.line-clamp-2 {\n  display: -webkit-box;\n  -webkit-line-clamp: 2;\n  -webkit-box-orient: vertical;\n  overflow: hidden;\n  line-clamp: 2;\n}\n</style>\n"],"names":["name","_a","description","resolve","checkInterval","script","htmlContent","error","elementName","previewContainer","element","style","chartContainer","canvas","svg","chartElement","_createElementBlock","widget","_createElementVNode","_openBlock","_cache","_toDisplayString","_withModifiers","$event"],"mappings":"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"}