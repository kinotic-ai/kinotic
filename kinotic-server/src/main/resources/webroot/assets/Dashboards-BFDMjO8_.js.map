{"version":3,"file":"Dashboards-BFDMjO8_.js","sources":["../../src/pages/Dashboards.vue"],"sourcesContent":["<script lang=\"ts\" setup>\nimport { computed, ref, watch } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { APPLICATION_STATE } from '@/states/IApplicationState'\nimport { DashboardEntityService } from '@/services/DashboardEntityService'\nimport { Dashboard } from '@/domain/Dashboard'\nimport CrudTable from '@/components/CrudTable.vue'\nimport Button from 'primevue/button'\nimport Menu from 'primevue/menu'\nimport Dialog from 'primevue/dialog'\nimport { useToast } from 'primevue/usetoast'\nimport { type IDataSource, type IterablePage, Pageable } from '@kinotic/continuum-client'\n\nconst router = useRouter()\nconst toast = useToast()\n\nconst props = defineProps<{ applicationId?: string }>()\n\nconst currentApplicationId = computed(() => {\n  return props.applicationId || APPLICATION_STATE.currentApplication?.id || ''\n})\n\nconst title = computed(() => `Dashboards${currentApplicationId.value ? ` â€“ ${currentApplicationId.value}` : ''}`)\n\nconst dashboardService = new DashboardEntityService()\nconst crudTableRef = ref<any>(null)\nconst tableKey = ref(0)\nconst actionMenus = ref<any[]>([])\nconst currentActionItem = ref<Dashboard | null>(null)\nconst showDeleteModal = ref(false)\nconst selectedDashboard = ref<Dashboard | null>(null)\nconst isDeleting = ref(false)\n\nconst dashboardDataSource: IDataSource<Dashboard> = {\n  async findAll(pageable: Pageable): Promise<IterablePage<Dashboard>> {\n    \n    if (!currentApplicationId.value) {\n      const emptyResult = await dashboardService.findAll(pageable)\n      return {\n        ...emptyResult,\n        content: [],\n        totalElements: 0\n      }\n    }\n    \n    try {\n      const allPageable = Pageable.create(0, 10000)\n      const result = await dashboardService.findAll(allPageable)\n      const filteredDashboards = (result.content || []).filter(dashboard => {\n        const matches = dashboard.applicationId === currentApplicationId.value\n        return matches\n      })\n      return {\n        ...result,\n        content: filteredDashboards,\n        totalElements: filteredDashboards.length\n      }\n    } catch (error) {\n      const emptyResult = await dashboardService.findAll(pageable)\n      return {\n        ...emptyResult,\n        content: [],\n        totalElements: 0\n      }\n    }\n  },\n  \n  async search(searchText: string, pageable: Pageable): Promise<IterablePage<Dashboard>> {\n    \n    if (!currentApplicationId.value) {\n      const emptyResult = await dashboardService.findAll(pageable)\n      return {\n        ...emptyResult,\n        content: [],\n        totalElements: 0\n      }\n    }\n    \n    try {\n      const allPageable = Pageable.create(0, 10000)\n      const result = await dashboardService.findAll(allPageable)\n      \n      const filteredDashboards = (result.content || []).filter(dashboard => {\n        const matchesApp = dashboard.applicationId === currentApplicationId.value\n        const matchesSearch = dashboard.name?.toLowerCase().includes(searchText.toLowerCase()) ||\n                             dashboard.description?.toLowerCase().includes(searchText.toLowerCase())\n        return matchesApp && matchesSearch\n      })\n      \n      \n      return {\n        ...result,\n        content: filteredDashboards,\n        totalElements: filteredDashboards.length\n      }\n    } catch (error) {\n      const emptyResult = await dashboardService.findAll(pageable)\n      return {\n        ...emptyResult,\n        content: [],\n        totalElements: 0\n      }\n    }\n  }\n}\n\n\nconst tableHeaders = [\n  { field: 'name', header: 'Name', sortable: true },\n  { field: 'description', header: 'Description', sortable: true },\n  { field: 'created', header: 'Created', sortable: true },\n  { field: 'updated', header: 'Updated', sortable: true },\n  { field: 'actions', header: '', sortable: false }\n]\n\nconst openDeleteModal = (dashboard: Dashboard) => {\n  selectedDashboard.value = dashboard\n  showDeleteModal.value = true\n}\n\nconst closeDeleteModal = () => {\n  showDeleteModal.value = false\n  selectedDashboard.value = null\n  isDeleting.value = false\n}\n\nconst deleteDashboard = async () => {\n  if (!selectedDashboard.value?.id) {\n    toast.add({ severity: 'error', summary: 'Error', detail: 'Dashboard ID is missing', life: 3000 })\n    return\n  }\n\n  isDeleting.value = true\n\n  try {\n    \n    // const _result = await dashboardService.deleteById(selectedDashboard.value.id)\n    await dashboardService.deleteById(selectedDashboard.value.id)\n    \n    toast.add({ severity: 'success', summary: 'Success', detail: 'Dashboard deleted successfully', life: 3000 })\n    \n    tableKey.value++\n    \n    closeDeleteModal()\n  } catch (error: any) {\n    toast.add({ \n      severity: 'error', \n      summary: 'Error', \n      detail: error.message || error.statusText || 'Failed to delete dashboard',\n      life: 3000\n    })\n  } finally {\n    isDeleting.value = false\n  }\n}\n\nconst toggleMenu = (event: Event, item: Dashboard, index: number) => {\n  currentActionItem.value = item\n  const menu = actionMenus.value[index]\n  if (menu) {\n    menu.toggle(event)\n  }\n}\n\nconst getActionMenu = (item: Dashboard) => {\n  return [\n    {\n      label: 'Delete',\n      icon: 'pi pi-trash',\n      command: () => openDeleteModal(item)\n    }\n  ]\n}\n\nconst openDashboard = (dashboard: Dashboard) => {\n  if (!dashboard.id) {\n    toast.add({ severity: 'error', summary: 'Error', detail: 'Dashboard ID is missing', life: 3000 })\n    return\n  }\n  \n  if (!currentApplicationId.value) {\n    toast.add({ severity: 'error', summary: 'Error', detail: 'Application ID is missing', life: 3000 })\n    return\n  }\n  \n  const route = `/application/${currentApplicationId.value}/dashboards/${dashboard.id}`\n  router.push(route)\n}\n\nconst createNewDashboard = () => {\n  router.push(`/application/${currentApplicationId.value}/dashboards/new`)\n}\n\n\nwatch(() => router.currentRoute.value.query.refresh, () => {\n})\n\n</script>\n\n<template>\n  <div class=\"p-6 h-full\">\n    <div class=\"flex justify-between items-center mb-6 border-b border-surface-200 pb-6\">\n      <h1 class=\"text-2xl font-semibold text-surface-950\">{{ title }}</h1>\n    </div>\n    \n    <div class=\"h-[calc(100vh-140px)]\">\n      <CrudTable\n        :key=\"tableKey\"\n        ref=\"crudTableRef\"\n        :dataSource=\"dashboardDataSource\"\n        :headers=\"tableHeaders\"\n        :defaultPageSize=\"50\"\n        :isShowAddNew=\"true\"\n        :isShowDelete=\"true\"\n        @delete=\"deleteDashboard\"\n        @onRowClick=\"openDashboard\"\n        @add-item=\"createNewDashboard\"\n        createNewButtonText=\"New dashboard\"\n        row-clickable\n      >\n        <template #item.created=\"{ item }\">\n          {{ item.created ? new Date(item.created).toLocaleDateString() : '-' }}\n        </template>\n        <template #item.updated=\"{ item }\">\n          {{ item.updated ? new Date(item.updated).toLocaleDateString() : '-' }}\n        </template>\n        <template #item.actions=\"{ item }\">\n          <div class=\"flex items-center justify-center\">\n            <Button\n              icon=\"pi pi-ellipsis-v\"\n              @click.stop=\"(event) => toggleMenu(event, item, item.id)\"\n              aria-haspopup=\"true\"\n              :aria-controls=\"'action_menu_' + item.id\"\n              type=\"button\"\n              severity=\"secondary\"\n              variant=\"text\"\n            />\n            <Menu\n              :ref=\"(el) => (actionMenus[item.id] = el)\"\n              :model=\"getActionMenu(item)\"\n              :popup=\"true\"\n              :id=\"'action_menu_' + item.id\"\n            />\n          </div>\n        </template>\n      </CrudTable>\n    </div>\n\n    <Dialog\n      v-model:visible=\"showDeleteModal\"\n      modal\n      :style=\"{ width: '450px' }\"\n      :closable=\"false\"\n    >\n      <template #header>\n        <div class=\"flex items-center\">\n          <i class=\"pi pi-exclamation-triangle text-red-500 mr-3 text-lg\"></i>\n          <span class=\"text-lg font-semibold\">Delete Dashboard</span>\n        </div>\n      </template>\n      \n      <div class=\"py-4\">\n        <p class=\"text-gray-700 mb-4\">\n          Are you sure you want to delete the dashboard \n          <strong>\"{{ selectedDashboard?.name }}\"</strong>?\n        </p>\n        <p class=\"text-sm text-gray-500\">\n          This action cannot be undone. All widgets and configurations will be permanently removed.\n        </p>\n      </div>\n\n      <template #footer>\n        <div class=\"flex justify-end gap-3\">\n          <Button\n            label=\"Cancel\"\n            severity=\"secondary\"\n            @click=\"closeDeleteModal\"\n            :disabled=\"isDeleting\"\n            class=\"px-4 py-2\"\n          />\n          <Button\n            label=\"Delete\"\n            severity=\"danger\"\n            @click=\"deleteDashboard\"\n            :loading=\"isDeleting\"\n            class=\"px-4 py-2\"\n          />\n        </div>\n      </template>\n    </Dialog>\n\n  </div>\n</template>\n\n\n"],"names":["router","useRouter","toast","useToast","props","__props","currentApplicationId","computed","_a","APPLICATION_STATE","title","dashboardService","DashboardEntityService","crudTableRef","ref","tableKey","actionMenus","currentActionItem","showDeleteModal","selectedDashboard","isDeleting","dashboardDataSource","pageable","allPageable","Pageable","result","filteredDashboards","dashboard","searchText","matchesApp","matchesSearch","_b","tableHeaders","openDeleteModal","closeDeleteModal","deleteDashboard","error","toggleMenu","event","item","index","menu","getActionMenu","openDashboard","route","createNewDashboard","watch","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_toDisplayString","_hoisted_4","_createBlock","CrudTable","_withCtx","_hoisted_5","_createVNode","_unref","Button","_withModifiers","Menu","el","Dialog","$event","_cache","_hoisted_8","_hoisted_6","_hoisted_7"],"mappings":"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"}