import{d as defineComponent,g as createDebug,i as ref,H as onMounted,c as createElementBlock,a as createBaseVNode,k as createCommentVNode,t as toDisplayString,l as withModifiers,o as openBlock,_ as _export_sfc}from"./index-D4TKg6Qf.js";const _hoisted_1=["data-widget-id"],_hoisted_2={class:"widget-chart-area bg-gray-50 p-2 relative"},_hoisted_3={key:0,class:"widget-loading-overlay absolute inset-0 bg-white bg-opacity-90 flex items-center justify-center z-10"},_hoisted_4=["data-widget-id"],_hoisted_5={class:"p-3 relative"},_hoisted_6={class:"font-semibold text-sm text-gray-900 mb-1 pr-6"},_hoisted_7={class:"text-xs text-gray-500 line-clamp-2 pr-6"},_sfc_main=defineComponent({__name:"SavedWidgetItem",props:{widget:{}},emits:["delete"],setup(__props,{emit:__emit}){const debug=createDebug("saved-widget-item"),props=__props,emit=__emit,previewLoaded=ref(!1),getWidgetTitle=()=>{var t;try{const e=((t=props.widget.dataInsightsComponent)==null?void 0:t.name)||"";return e&&e.length>0?e:"Data Insight"}catch{return"Data Insight"}},getWidgetSubtitle=()=>{var t;try{const e=((t=props.widget.dataInsightsComponent)==null?void 0:t.description)||"";return e&&e.length>0?e:"Data visualization"}catch{return"Data visualization"}},loadEchartsIfNeeded=()=>new Promise(t=>{if(window.echarts){t();return}if(window.echartsLoading){const s=setInterval(()=>{window.echarts&&(clearInterval(s),t())},100);return}window.echartsLoading=!0;const e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/echarts@5.5.1/dist/echarts.min.js",e.onload=()=>{window.echartsLoading=!1,t()},e.onerror=()=>{window.echartsLoading=!1,t()},document.head.appendChild(e)}),executeWidgetHTML=async()=>{var e;const t=((e=props.widget.dataInsightsComponent)==null?void 0:e.rawHtml)||"";t&&(t.includes("echarts")&&await loadEchartsIfNeeded(),executeWidgetElement(t))},executeWidgetElement=htmlContent=>{var t;try{const elementNameMatch=htmlContent.match(/customElements\.define\(['"`]([^'"`]+)['"`]/);let elementName=elementNameMatch?elementNameMatch[1]:null;if(!elementName)return;if(customElements.get(elementName)){debug("Element already registered, using existing: %s",elementName);const existingElement=customElements.get(elementName),newClassMatch=htmlContent.match(/class\s+(\w+)\s+extends\s+HTMLElement/),newClassName=newClassMatch?newClassMatch[1]:null;if(newClassName&&existingElement&&existingElement.name!==newClassName){const uniqueName=`${elementName}-${(t=props.widget.id)==null?void 0:t.substring(0,8)}`;debug("Element already registered, creating unique name: %s",uniqueName);const modifiedHtml=htmlContent.replace(`customElements.define('${elementName}'`,`customElements.define('${uniqueName}'`);eval(modifiedHtml),elementName=uniqueName}createWidgetElement(elementName);return}debug("Registering new element: %s",elementName),eval(htmlContent),setTimeout(()=>{elementName&&customElements.get(elementName)&&createWidgetElement(elementName)},500)}catch(e){debug("Error executing widget HTML: %O",e)}},createWidgetElement=t=>{var s;const e=document.querySelector(`[data-widget-id="${props.widget.id}"] .widget-preview-content`);if(debug("Creating element for: %s, registered: %s",(s=props.widget.dataInsightsComponent)==null?void 0:s.name,!!customElements.get(t)),e){const n=document.createElement(t);debug("Element created: %s",t),e.innerHTML="",e.appendChild(n),debug("Element appended to container"),setTimeout(()=>{if(debug("Checking shadow root - exists: %s",!!n.shadowRoot),n.shadowRoot){debug("Shadow root confirmed");const i=document.createElement("style");n.shadowRoot.appendChild(i),debug("Styles appended"),setTimeout(()=>{var o;if(debug("Preview loaded for: %s",(o=props.widget.dataInsightsComponent)==null?void 0:o.name),previewLoaded.value=!0,n.shadowRoot){const d=n.shadowRoot.querySelector('.chart-container, [id="chart"]');debug("Chart container in shadow: %s",!!d);const r=n.shadowRoot.querySelector("canvas"),c=n.shadowRoot.querySelector("svg");debug("Canvas: %s, SVG: %s",!!r,!!c);const a=n.shadowRoot.querySelector('canvas, svg, [id="chart"]');a&&a.__ec_inner__?setTimeout(()=>{debug("Resizing echarts"),a.__ec_inner__.resize(),debug("ECharts resized")},500):debug("No echarts instance found (might be other chart library)")}},1e3)}else debug("No shadow root found!")},300)}else debug("Preview container not found for: %s",props.widget.id)};return onMounted(()=>{setTimeout(()=>{executeWidgetHTML()},200)}),(t,e)=>(openBlock(),createElementBlock("div",{"data-widget-id":t.widget.id||"",class:"widget-card bg-white rounded-lg border border-surface-200 overflow-hidden h-[220px]"},[createBaseVNode("div",_hoisted_2,[previewLoaded.value?createCommentVNode("",!0):(openBlock(),createElementBlock("div",_hoisted_3,e[1]||(e[1]=[createBaseVNode("div",{class:"text-center"},[createBaseVNode("i",{class:"pi pi-spin pi-spinner text-blue-500 text-lg mb-1"}),createBaseVNode("div",{class:"text-xs text-gray-600"},"Loading...")],-1)]))),createBaseVNode("div",{class:"widget-preview-content","data-widget-id":t.widget.id},e[2]||(e[2]=[createBaseVNode("div",{class:"chart-placeholder",style:{display:"none",color:"#999","font-size":"12px","text-align":"center"}}," Loading chart... ",-1)]),8,_hoisted_4)]),createBaseVNode("div",_hoisted_5,[createBaseVNode("div",_hoisted_6,toDisplayString(getWidgetTitle()),1),createBaseVNode("div",_hoisted_7,toDisplayString(getWidgetSubtitle()),1),createBaseVNode("button",{onClick:e[0]||(e[0]=withModifiers(s=>emit("delete",t.widget.id),["stop"])),class:"absolute top-2 right-2 text-gray-400 hover:text-red-500 transition-colors p-1",title:"Delete Widget"},e[3]||(e[3]=[createBaseVNode("i",{class:"pi pi-trash text-xs"},null,-1)]))])],8,_hoisted_1))}}),SavedWidgetItem=_export_sfc(_sfc_main,[["__scopeId","data-v-d26f0c13"]]);export{SavedWidgetItem as S};
//# sourceMappingURL=SavedWidgetItem-DRn6fR6H.js.map
