import{d as F,u as G,j as I,A as H,i as n,p as K,c as J,a as o,e as p,t as y,b as Q,w as i,m,G as W,o as R,l as X,D as b,M as S}from"./index-BAuc_XpL.js";import{D as Y}from"./DashboardEntityService-DkSf9xar.js";import{_ as Z}from"./CrudTable-Dx3WuCAV.js";import{s as w}from"./index-d3RWyEKF.js";import{s as ee}from"./index-Bpk6tSGt.js";import{s as te}from"./index-BWJDcOuA.js";import"./index-AFbNaqJX.js";import"./index-g95NevXP.js";import"./index-D9EM4B1w.js";import"./index-DN8o-Nsy.js";import"./index-Bz44qjX7.js";import"./index-CqdoTLcK.js";import"./index-2fgv3Tde.js";import"./index-ChDFEGgs.js";import"./index-DeH_O1z3.js";import"./index-8yU-erlp.js";import"./component-CLWqUams.js";const ae={class:"p-6 h-full"},se={class:"flex justify-between items-center mb-6 border-b border-surface-200 pb-6"},oe={class:"text-2xl font-semibold text-surface-950"},le={class:"h-[calc(100vh-140px)]"},re={class:"flex items-center justify-center"},ne={class:"py-4"},ie={class:"text-gray-700 mb-4"},de={class:"flex justify-end gap-3"},Ie=F({__name:"Dashboards",props:{applicationId:{}},setup(k){const D=W(),d=G(),N=k,l=I(()=>{var a;return N.applicationId||((a=H.currentApplication)==null?void 0:a.id)||""}),T=I(()=>`Dashboards${l.value?` â€“ ${l.value}`:""}`),r=new Y,M=n(null),g=n(0),_=n([]),L=n(null),f=n(!1),c=n(null),u=n(!1),$={async findAll(a){if(!l.value)return{...await r.findAll(a),content:[],totalElements:0};try{const t=S.create(0,1e4),e=await r.findAll(t),s=(e.content||[]).filter(v=>v.applicationId===l.value);return{...e,content:s,totalElements:s.length}}catch{return{...await r.findAll(a),content:[],totalElements:0}}},async search(a,t){if(!l.value)return{...await r.findAll(t),content:[],totalElements:0};try{const e=S.create(0,1e4),s=await r.findAll(e),v=(s.content||[]).filter(h=>{var C,E;const q=h.applicationId===l.value,z=((C=h.name)==null?void 0:C.toLowerCase().includes(a.toLowerCase()))||((E=h.description)==null?void 0:E.toLowerCase().includes(a.toLowerCase()));return q&&z});return{...s,content:v,totalElements:v.length}}catch{return{...await r.findAll(t),content:[],totalElements:0}}}},B=[{field:"name",header:"Name",sortable:!0},{field:"description",header:"Description",sortable:!0},{field:"created",header:"Created",sortable:!0},{field:"updated",header:"Updated",sortable:!0},{field:"actions",header:"",sortable:!1}],P=a=>{c.value=a,f.value=!0},x=()=>{f.value=!1,c.value=null,u.value=!1},A=async()=>{var a;if(!((a=c.value)!=null&&a.id)){d.add({severity:"error",summary:"Error",detail:"Dashboard ID is missing",life:3e3});return}u.value=!0;try{await r.deleteById(c.value.id),d.add({severity:"success",summary:"Success",detail:"Dashboard deleted successfully",life:3e3}),g.value++,x()}catch(t){d.add({severity:"error",summary:"Error",detail:t.message||t.statusText||"Failed to delete dashboard",life:3e3})}finally{u.value=!1}},j=(a,t,e)=>{L.value=t;const s=_.value[e];s&&s.toggle(a)},V=a=>[{label:"Delete",icon:"pi pi-trash",command:()=>P(a)}],O=a=>{if(!a.id){d.add({severity:"error",summary:"Error",detail:"Dashboard ID is missing",life:3e3});return}if(!l.value){d.add({severity:"error",summary:"Error",detail:"Application ID is missing",life:3e3});return}const t=`/application/${l.value}/dashboards/${a.id}`;D.push(t)},U=()=>{D.push(`/application/${l.value}/dashboards/new`)};return K(()=>D.currentRoute.value.query.refresh,()=>{}),(a,t)=>(R(),J("div",ae,[o("div",se,[o("h1",oe,y(T.value),1)]),o("div",le,[(R(),Q(Z,{key:g.value,ref_key:"crudTableRef",ref:M,dataSource:$,headers:B,defaultPageSize:50,isShowAddNew:!0,isShowDelete:!0,onDelete:A,onOnRowClick:O,onAddItem:U,createNewButtonText:"New dashboard","row-clickable":""},{"item.created":i(({item:e})=>[b(y(e.created?new Date(e.created).toLocaleDateString():"-"),1)]),"item.updated":i(({item:e})=>[b(y(e.updated?new Date(e.updated).toLocaleDateString():"-"),1)]),"item.actions":i(({item:e})=>[o("div",re,[p(m(w),{icon:"pi pi-ellipsis-v",onClick:X(s=>j(s,e,e.id),["stop"]),"aria-haspopup":"true","aria-controls":"action_menu_"+e.id,type:"button",severity:"secondary",variant:"text"},null,8,["onClick","aria-controls"]),p(m(ee),{ref:s=>_.value[e.id]=s,model:V(e),popup:!0,id:"action_menu_"+e.id},null,8,["model","id"])])]),_:1}))]),p(m(te),{visible:f.value,"onUpdate:visible":t[0]||(t[0]=e=>f.value=e),modal:"",style:{width:"450px"},closable:!1},{header:i(()=>t[1]||(t[1]=[o("div",{class:"flex items-center"},[o("i",{class:"pi pi-exclamation-triangle text-red-500 mr-3 text-lg"}),o("span",{class:"text-lg font-semibold"},"Delete Dashboard")],-1)])),footer:i(()=>[o("div",de,[p(m(w),{label:"Cancel",severity:"secondary",onClick:x,disabled:u.value,class:"px-4 py-2"},null,8,["disabled"]),p(m(w),{label:"Delete",severity:"danger",onClick:A,loading:u.value,class:"px-4 py-2"},null,8,["loading"])])]),default:i(()=>{var e;return[o("div",ne,[o("p",ie,[t[2]||(t[2]=b(" Are you sure you want to delete the dashboard ")),o("strong",null,'"'+y((e=c.value)==null?void 0:e.name)+'"',1),t[3]||(t[3]=b("? "))]),t[4]||(t[4]=o("p",{class:"text-sm text-gray-500"}," This action cannot be undone. All widgets and configurations will be permanently removed. ",-1))])]}),_:1},8,["visible"])]))}});export{Ie as default};
//# sourceMappingURL=Dashboards-B1eB98vd.js.map
