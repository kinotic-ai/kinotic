var tt=Object.defineProperty;var st=(e,m,t)=>m in e?tt(e,m,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[m]=t;var $=(e,m,t)=>st(e,typeof m!="symbol"?m+"":m,t);import{s as Ue}from"./index-BAOkBHjZ.js";import{a as ke,b as We,c as Me,_ as Ie}from"./CrudTable-BTfC722O.js";import{s as ce}from"./index-9qJBPOsq.js";import{s as Ne}from"./index-CWmb5psA.js";import{B as ge,d as se,c as Se,C as be,a as nt,b as Ae}from"./component-CWCFeeTt.js";import{c as u,o as a,a as y,d as Ee,D as it,t as S,F as j,C as O,e as R,m as oe,j as Oe,ah as V,_ as ve,r as re,y as He,z as Ke,w as B,n as ie,g as Te,ar as Xe,as as we,M as qe,b as ee,k as D,aj as Je,B as J,l as I,at as _e,X as ue,O as ot,P as rt,Q as lt,Y as at,f as dt,ai as ut,A as ze}from"./index-D4TKg6Qf.js";import{D as Ve}from"./DatetimeUtil-C1mlUI8S.js";import{P as De,_ as je,d as Le,M as he,a as ct,b as pt,c as mt,e as ht}from"./theme-default-BlCVeWFY.js";import{s as ft}from"./index-DDlLA5SA.js";function yt(e,m){return a(),u("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[y("path",{"fill-rule":"evenodd",d:"M15.97 2.47a.75.75 0 0 1 1.06 0l4.5 4.5a.75.75 0 0 1 0 1.06l-4.5 4.5a.75.75 0 1 1-1.06-1.06l3.22-3.22H7.5a.75.75 0 0 1 0-1.5h11.69l-3.22-3.22a.75.75 0 0 1 0-1.06Zm-7.94 9a.75.75 0 0 1 0 1.06l-3.22 3.22H16.5a.75.75 0 0 1 0 1.5H4.81l3.22 3.22a.75.75 0 1 1-1.06 1.06l-4.5-4.5a.75.75 0 0 1 0-1.06l4.5-4.5a.75.75 0 0 1 1.06 0Z","clip-rule":"evenodd"})])}function gt(e,m){return a(),u("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[y("path",{"fill-rule":"evenodd",d:"M6.97 2.47a.75.75 0 0 1 1.06 0l4.5 4.5a.75.75 0 0 1-1.06 1.06L8.25 4.81V16.5a.75.75 0 0 1-1.5 0V4.81L3.53 8.03a.75.75 0 0 1-1.06-1.06l4.5-4.5Zm9.53 4.28a.75.75 0 0 1 .75.75v11.69l3.22-3.22a.75.75 0 1 1 1.06 1.06l-4.5 4.5a.75.75 0 0 1-1.06 0l-4.5-4.5a.75.75 0 1 1 1.06-1.06l3.22 3.22V7.5a.75.75 0 0 1 .75-.75Z","clip-rule":"evenodd"})])}const bt={class:"rounded-lg overflow-hidden bg-white text-xs min-w-[200px] border border-surface-100"},vt={class:"p-3 bg-surface-950 font-semibold text-white flex items-center gap-2"},wt={class:"font-normal text-xs text-surface-900"},xt={class:"text-gray-500 text-xs font-bold bg-gray-200 ml-2 px-2 py-1 rounded-xl"},Ct=Ee({__name:"GlobalObjectNode",props:{data:{}},setup(e){return(m,t)=>(a(),u("div",bt,[y("div",null,[y("div",vt,[t[0]||(t[0]=y("i",{class:"pi pi-table text-[#C8FB39]"},null,-1)),it(" "+S(m.data.label),1)])]),(a(!0),u(j,null,O(m.data.fields,(i,o)=>(a(),u("div",{key:o,class:"relative px-2 py-1 border-t border-surface-100 flex justify-between items-center"},[y("span",wt,S(i.name),1),y("span",xt,S(i.type),1),R(oe(je),{type:"source",position:oe(De).Right,id:`out-${o}`,class:"w-2 h-2 opacity-0 absolute right-[-6px] top-1/2 transform -translate-y-1/2"},null,8,["position","id"])]))),128))]))}}),le=[{background:"#ecfccb",border:"#84cc16",label:"#65a30d",header:"#ECFCCB"},{background:"#ecfccb",border:"#84cc16",label:"#65a30d",header:"#ECFCCB"},{background:"#FDF4FF",border:"#F5D0FE",label:"#D946EF",header:"#FAE8FF"},{background:"#F5F3FF",border:"#DDD6FE",label:"#7C3AED",header:"#EDE9FE"},{background:"#EFF8FF",border:"#BAE6FD",label:"#0284C7",header:"#7DD3FC"},{background:"#DFFCF3",border:"#A7F3D0",label:"#059669",header:"#6EE7B7"}],$t={class:"rounded-lg overflow-hidden bg-white text-xs min-w-[200px] border border-surface-100"},kt={class:"font-normal text-xs text-surface-900"},Nt={class:"text-gray-500 text-xs font-bold bg-gray-200 ml-2 px-2 py-1 rounded-xl"},St=Ee({__name:"ObjectNode",props:{data:{}},setup(e){const m=e,t=Oe(()=>{const i=m.data.rowIndex??0;return le[i%le.length]});return(i,o)=>(a(),u("div",$t,[y("div",{class:"p-3 font-semibold text-surface-900 flex items-center gap-2",style:V({backgroundColor:t.value.header})},S(i.data.label),5),(a(!0),u(j,null,O(i.data.fields,(r,p)=>(a(),u("div",{key:p,class:"relative px-2 py-1 border-t border-surface-100 flex justify-between items-center"},[y("span",kt,S(r.name),1),y("span",Nt,S(r.type),1),R(oe(je),{type:"source",position:oe(De).Right,id:`out-${p}`,class:"w-2 h-2 opacity-0 absolute right-[-6px] top-1/2 transform -translate-y-1/2"},null,8,["position","id"])]))),128))]))}}),At={class:"rounded-lg overflow-hidden bg-white text-xs min-w-[200px] border border-surface-100"},Et={class:"font-normal text-xs text-surface-900"},Dt=Ee({__name:"EnumNode",props:{data:{}},setup(e){const m=e,t=Oe(()=>{const i=m.data.rowIndex??0;return le[i%le.length]});return(i,o)=>(a(),u("div",At,[y("div",{class:"p-3 font-semibold text-surface-900 flex items-center gap-2",style:V({backgroundColor:t.value.header})},S(i.data.label),5),(a(!0),u(j,null,O(i.data.fields,(r,p)=>(a(),u("div",{key:p,class:"relative px-2 py-1 border-t border-surface-100 flex justify-between items-center"},[y("span",Et,S(r.name),1),R(oe(je),{type:"source",position:oe(De).Right,id:`out-${p}`,class:"w-2 h-2 opacity-0 absolute right-[-6px] top-1/2 transform -translate-y-1/2"},null,8,["position","id"])]))),128))]))}}),jt={class:"flex flex-row overflow-auto gap-4"},zt=Ee({__name:"UnionNode",props:{data:{}},setup(e){const m=e,t=Oe(()=>{const i=m.data.rowIndex??0;return le[i%le.length]});return(i,o)=>(a(),u("div",{class:"relative rounded-xl text-xs min-w-[200px] p-6",style:V({backgroundColor:t.value.background,border:`1px solid ${t.value.border}`})},[y("div",{class:"absolute top-[-12px] left-3 text-xs font-semibold px-2 py-1 text-white rounded-sm",style:V({backgroundColor:t.value.label})},S(i.data.label),5),y("div",jt,[(a(!0),u(j,null,O(i.data.variants,(r,p)=>(a(),u("div",{key:p,class:"flex flex-col bg-white rounded shadow min-w-[160px]"},[y("div",{class:"font-semibold text-surface-900 text-xs p-2 w-full",style:V({backgroundColor:t.value.header})},S(r.name||`Variant ${p+1}`),5),(a(!0),u(j,null,O(r.fields,(h,g)=>(a(),u("div",{key:g,class:"border-t border-surface-100 text-xs p-2 text-gray-700"},S(h),1))),128)),R(oe(je),{type:"source",position:oe(De).Right,id:`out-${p}`,class:"w-2 h-2 absolute right-[-6px] top-1/2 transform -translate-y-1/2",style:V({backgroundColor:t.value.label})},null,8,["position","id","style"])]))),128))])],4))}});var Wt=Object.defineProperty,Mt=Object.getOwnPropertyDescriptor,Re=(e,m,t,i)=>{for(var o=i>1?void 0:i?Mt(m,t):m,r=e.length-1,p;r>=0;r--)(p=e[r])&&(o=(i?p(m,t,o):p(o))||o);return i&&o&&Wt(m,t,o),o};let fe=class extends ge{constructor(){super(...arguments);$(this,"item");$(this,"visible",!0);$(this,"flowNodes",[]);$(this,"flowEdges",[])}closeModal(){return!0}onHide(){this.visible=!1,this.closeModal()}get nodeTypes(){return{globalObject:Ct,objectNode:St,enumNode:Dt,unionNode:zt}}mounted(){this.setupGraph()}setupGraph(){var l;const t=(l=this.item)==null?void 0:l.entityDefinition;if(!t||!Array.isArray(t.properties))return;this.flowEdges=[];let i=0,o=20;const r=[],p=()=>{const d=["bg-orange-300","bg-blue-300","bg-green-300","bg-purple-300","bg-pink-300","bg-yellow-300","bg-teal-300"];return d[Math.floor(Math.random()*d.length)]},h=d=>{const w=d.reduce((C,x)=>C+(x.fields.length*20+20),60);return Math.max(150,w)},g=(d,b,c,f=0,w="objectNode")=>{const C=`${d}_${i++}`,x=Math.max(150,50+c.length*20);return r.push({id:C,type:f===0?"globalObject":w,position:{x:100+f*350,y:o},data:{label:b,fields:c,color:p()}}),o+=x+40,C},s=new Map,n=(d,b,c=0)=>{const f=b+JSON.stringify(d.map(x=>x.name));if(s.has(f))return s.get(f);const w=[],C=g(b,b,w,c,c===0?"globalObject":"objectNode");return s.set(f,C),d.forEach((x,T)=>{var A,N,W,M,_,L,Z,Q,Y,de;const v=x.name||`prop${T}`,z=(A=x.type)==null?void 0:A.type;let E="";const k=w.length;if(z==="object"&&Array.isArray((N=x.type)==null?void 0:N.properties))E=n(x.type.properties,x.type.name||v,c+1),w.push({name:v,type:((W=x.type)==null?void 0:W.name)||"object"});else if(z==="array"){const H=(M=x.type.contains)==null?void 0:M.type,U=((_=x.type.contains)==null?void 0:_.name)||v;if(H==="object"&&Array.isArray((L=x.type.contains)==null?void 0:L.properties))E=n(x.type.contains.properties,U,c+1),w.push({name:v,type:`${U}[]`});else if(H==="union"&&Array.isArray((Z=x.type.contains)==null?void 0:Z.types)){w.push({name:v,type:"union[]"});const X=x.type.contains.types.map((K,P)=>({name:K.name||`${v}_Variant_${P+1}`,fields:(K.properties||[]).map(pe=>{var me;return`${pe.name}: ${((me=pe.type)==null?void 0:me.type)||"unknown"}`})})),F=`${v}_union_group_${i++}`;r.push({id:F,type:"unionNode",position:{x:100+(c+1)*350,y:o},data:{label:v,variants:X,color:"bg-red-500"}}),o+=h(X)+40,this.flowEdges.push({id:`e-${C}-${F}`,source:C,sourceHandle:`out-${k}`,target:F,targetHandle:"in-0",animated:!0,markerEnd:{type:he.Arrow}})}else if(H==="enum"&&Array.isArray((Q=x.type.contains)==null?void 0:Q.values)){w.push({name:v,type:`${U}[]`});const X=x.type.contains.values.map(P=>({name:P,type:""})),F=JSON.stringify(X)+U;let K;s.has(F)?K=s.get(F):(K=g(`${v}_enum_array`,U,X,c+1,"enumNode"),s.set(F,K)),this.flowEdges.push({id:`e-${C}-${K}`,source:C,sourceHandle:`out-${k}`,target:K,targetHandle:"in-0",type:"default",animated:!0,markerEnd:{type:he.Arrow}})}else w.push({name:v,type:`${H}[]`})}else if(z==="union"&&Array.isArray(x.type.types)){w.push({name:v,type:"union"});const H=x.type.types.map((X,F)=>({name:X.name||`${v}_Variant_${F+1}`,fields:(X.properties||[]).map(K=>{var P;return`${K.name}: ${((P=K.type)==null?void 0:P.type)||"unknown"}`})})),U=`${v}_union_group_${i++}`;r.push({id:U,type:"unionNode",position:{x:100+(c+1)*350,y:o},data:{label:v,variants:H,color:"bg-red-500"}}),o+=h(H)+40,this.flowEdges.push({id:`e-${C}-${U}`,source:C,sourceHandle:`out-${k}`,target:U,targetHandle:"in-0",animated:!0,markerEnd:{type:he.Arrow}})}else if(z==="enum"&&Array.isArray((Y=x.type)==null?void 0:Y.values)){const H=((de=x.type)==null?void 0:de.name)||`${v}_Enum`;w.push({name:v,type:H});const U=x.type.values.map(K=>({name:K,type:""})),X=JSON.stringify(U)+H;let F;s.has(X)?F=s.get(X):(F=g(`${v}_enum`,H,U,c+1,"enumNode"),s.set(X,F)),this.flowEdges.push({id:`e-${C}-${F}`,source:C,sourceHandle:`out-${k}`,target:F,targetHandle:"in-0",type:"default",animated:!0,markerEnd:{type:he.Arrow}})}else w.push({name:v,type:z||"unknown"});E&&this.flowEdges.push({id:`e-${C}-${E}`,source:C,sourceHandle:`out-${k}`,target:E,targetHandle:"in-0",type:"default",animated:!0,markerEnd:{type:he.Arrow}})}),C};n(t.properties,t.name||"Root"),this.flowNodes=r,this.applyAutoLayout("LR"),this.$nextTick(()=>{var d,b;(b=(d=this.$refs.flow)==null?void 0:d.fitView)==null||b.call(d)})}applyAutoLayout(t="LR"){const i=new Le.graphlib.Graph({multigraph:!0});i.setGraph({rankdir:t,nodesep:t==="LR"?200:600,ranksep:t==="LR"?600:200,marginx:20,marginy:40}),i.setDefaultEdgeLabel(()=>({})),this.flowNodes.forEach(p=>{var n,l,d,b;const h=((l=(n=p.data)==null?void 0:n.fields)==null?void 0:l.length)||((b=(d=p.data)==null?void 0:d.variants)==null?void 0:b.length)||0,g=Math.max(100,40+h*30);i.setNode(p.id,{width:220,height:g})}),this.flowEdges.forEach(p=>{i.setEdge(p.source,p.target)}),Le.layout(i);const o=new Map;let r=0;this.flowNodes=this.flowNodes.map(p=>{const h=i.node(p.id);if(!h)return p;const g=t==="TB"?h.y:h.x,s=Math.round(g/50)*50;o.has(s)||o.set(s,r++);const n=o.get(s);return{...p,position:{x:h.x,y:h.y},positionAbsolute:{x:h.x,y:h.y},data:{...p.data,rowIndex:n}}})}};Re([se({default:null})],fe.prototype,"item",2);Re([Se("close")],fe.prototype,"closeModal",1);fe=Re([be({components:{VueFlow:ht,Background:mt,Controls:pt,MiniMap:ct,ArrowsRightLeftIcon:yt,ArrowsUpDownIcon:gt}})],fe);const Ot={class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},Tt={class:"relative w-full h-screen bg-white shadow-lg overflow-hidden"},Vt={class:"flex items-center justify-between p-4 border-b border-gray-200"},Rt={class:"h-full"};function _t(e,m,t,i,o,r){const p=re("ArrowsRightLeftIcon"),h=re("ArrowsUpDownIcon"),g=re("Controls"),s=re("Background"),n=re("MiniMap"),l=re("VueFlow");return He((a(),u("div",Ot,[y("div",Tt,[y("div",Vt,[m[4]||(m[4]=y("h3",{class:"text-xl font-semibold text-gray-900"},"Structure Details",-1)),R(g,{position:"top-center",class:"flex gap-2"},{default:B(()=>[y("button",{onClick:m[0]||(m[0]=d=>e.applyAutoLayout("LR")),title:"Horizontal Layout",class:"p-2 bg-gray-400 rounded hover:bg-gray-500"},[R(p,{class:"w-5 h-5 text-white"})]),y("button",{onClick:m[1]||(m[1]=d=>e.applyAutoLayout("TB")),title:"Vertical Layout",class:"p-2 bg-gray-400 rounded hover:bg-gray-500"},[R(h,{class:"w-5 h-5 text-white"})])]),_:1}),y("button",{onClick:m[2]||(m[2]=(...d)=>e.onHide&&e.onHide(...d)),class:"text-gray-400 hover:text-gray-900 hover:bg-gray-200 rounded-lg text-sm w-8 h-8 flex items-center justify-center"},m[3]||(m[3]=[y("svg",{class:"w-3 h-3",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 14 14"},[y("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"})],-1)]))]),y("div",Rt,[R(l,{ref:"flow",nodes:e.flowNodes,edges:e.flowEdges,"node-types":e.nodeTypes,minZoom:.01},{default:B(()=>[R(s,{"pattern-color":"#ccc",gap:20}),R(n),R(g,{position:"top-left"})]),_:1},8,["nodes","edges","node-types"])])])],512)),[[Ke,e.visible]])}const Ge=ve(fe,[["render",_t],["__scopeId","data-v-b3f172fd"]]);class xe{static hasDecorator(m,t){let i=!1;return t!==void 0&&t.length>0&&t.forEach(o=>{o.type===m&&(i=!0)}),i}static getPropertyDefinition(m,t){let i=null;for(const o of t)if(o.name===m){i=o;break}return i}}var Lt=Object.defineProperty,Ft=Object.getOwnPropertyDescriptor,Ze=(e,m,t,i)=>{for(var o=i>1?void 0:i?Ft(m,t):m,r=e.length-1,p;r>=0;r--)(p=e[r])&&(o=(i?p(m,t,o):p(o))||o);return i&&o&&Lt(m,t,o),o};const Fe=Te("entity-list-old");let Ce=class extends ge{constructor(){super(...arguments);$(this,"structureId");$(this,"loading",!1);$(this,"finishedInitialLoad",!1);$(this,"items",[]);$(this,"totalItems",0);$(this,"searchText",null);$(this,"keys",[]);$(this,"headers",[]);$(this,"structureProperties",{});$(this,"structure");$(this,"entitiesService",ie.getEntitiesService());$(this,"structureService",ie.getStructureService());$(this,"options",{rows:10,first:0,sortField:"",sortOrder:1})}mounted(){const t=this.$route.params.id,i=this.structureId||(Array.isArray(t)?t[0]:t);if(!i){this.displayAlert("Missing structure ID.");return}this.structureService.findById(i).then(o=>{this.structure=o,this.structureProperties=o.entityDefinition.properties;for(const r of this.structureProperties)if(r){const p=r.name[0].toUpperCase()+r.name.slice(1);let h=!0;(["ref","array","object"].includes(r.type.type)||r.type.type==="string"&&xe.hasDecorator("Text",r.decorators))&&(h=!1);const g=["ref","array","object"].includes(r.type.type),s={header:p,field:r.name,sortable:h,width:r.name==="id"?220:g?240:h?120:160,isCollapsable:g||(r==null?void 0:r.name)==="addresses"||(r==null?void 0:r.name)==="pet"};this.headers.push(s),this.keys.push(r.name)}this.find()}).catch(o=>{Fe("Error during structure retrieval: %O",o),this.displayAlert(o.message)})}formatDate(t){return Ve.formatDate(t)}isDateField(t){var i,o;return((o=(i=xe.getPropertyDefinition(t,this.structureProperties))==null?void 0:i.type)==null?void 0:o.type)==="date"}onPage(t){this.options.rows=t.rows,this.options.first=t.first,this.find()}onSort(t){this.options.sortField=t.sortField,this.options.sortOrder=t.sortOrder,this.find()}clearSearch(){this.searchText=null,this.options.first=0,this.find()}search(){this.options.first=0,this.find()}displayAlert(t){Fe("Display alert: %s",t)}find(){var g;if(this.loading)return;this.loading=!0;const t=this.options.first/this.options.rows,i=[];this.options.sortField&&i.push(new Xe(this.options.sortField,this.options.sortOrder===1?we.ASC:we.DESC));const o=qe.create(t,this.options.rows,{orders:i}),r=this.$route.params.id,p=this.structureId||(Array.isArray(r)?r[0]:r);((g=this.searchText)!=null&&g.length?this.entitiesService.search(p,this.searchText,o):this.entitiesService.findAll(p,o)).then(s=>{this.items=s.content??[],this.totalItems=s.totalElements??0,this.loading=!1,this.finishedInitialLoad||setTimeout(()=>{this.finishedInitialLoad=!0},500)}).catch(s=>{this.displayAlert(s.message),this.loading=!1,this.finishedInitialLoad||setTimeout(()=>{this.finishedInitialLoad=!0},500)})}};Ze([se({type:String})],Ce.prototype,"structureId",2);Ce=Ze([be({components:{DataTable:Me,Column:We,Toolbar:ke,Button:ce,InputText:Ne}})],Ce);const Bt={class:"overflow-y-auto w-full"},Ut={key:0},It={key:1},Ht={key:1,class:"p-4 text-center"};function Kt(e,m,t,i,o,r){const p=Ne,h=ce,g=ke,s=We,n=Me;return a(),u("div",Bt,[R(g,{class:"!w-full"},{start:B(()=>[R(p,{modelValue:e.searchText,"onUpdate:modelValue":m[0]||(m[0]=l=>e.searchText=l),placeholder:"Search",onKeyup:Je(e.search,["enter"]),onFocus:m[1]||(m[1]=l=>{var d;return(d=l.target)==null?void 0:d.select()}),class:"w-1/2"},null,8,["modelValue","onKeyup"]),e.searchText?(a(),ee(h,{key:0,icon:"pi pi-times",class:"ml-2",onClick:e.clearSearch},null,8,["onClick"])):D("",!0)]),_:1}),R(n,{value:e.items,loading:e.loading,paginator:!0,rows:e.options.rows,totalRecords:e.totalItems,first:e.options.first,lazy:!0,sortField:e.options.sortField,sortOrder:e.options.sortOrder,onPage:e.onPage,onSort:e.onSort,scrollable:!0,scrollHeight:"flex",resizableColumns:!0,columnResizeMode:"expand"},{default:B(()=>[e.headers.length>0?(a(!0),u(j,{key:0},O(e.headers,l=>(a(),ee(s,{key:l.field,field:l.field,header:l.header,sortable:l.sortable,style:V({width:l.width+"px"}),class:J([l.isCollapsable?"!whitespace-normal":""])},{body:B(d=>[y("div",{class:J([l.isCollapsable?"whitespace-normal break-words w-[240px] max-w-[240px] text-sm":"truncate"])},[typeof d.data[l.field]=="object"?(a(),u("span",Ut,S(JSON.stringify(d.data[l.field])),1)):(a(),u("span",It,S(e.isDateField(l.field)?e.formatDate(d.data[l.field]):d.data[l.field]),1))],2)]),_:2},1032,["field","header","sortable","style","class"]))),128)):D("",!0),e.items.length===0?(a(),u("div",Ht,[e.loading?D("",!0):(a(),ee(h,{key:0,label:"No Data - Push To Search Again",onClick:e.find},null,8,["onClick"]))])):D("",!0)]),_:1},8,["value","loading","rows","totalRecords","first","sortField","sortOrder","onPage","onSort"])])}const Qe=ve(Ce,[["render",Kt]]);var Xt=Object.defineProperty,qt=Object.getOwnPropertyDescriptor,Ye=(e,m,t,i)=>{for(var o=i>1?void 0:i?qt(m,t):m,r=e.length-1,p;r>=0;r--)(p=e[r])&&(o=(i?p(m,t,o):p(o))||o);return i&&o&&Xt(m,t,o),o};const Be=Te("entity-list");let $e=class extends ge{constructor(){super(...arguments);$(this,"structureId");$(this,"loading",!1);$(this,"finishedInitialLoad",!1);$(this,"items",[]);$(this,"totalItems",0);$(this,"searchText",null);$(this,"keys",[]);$(this,"headers",[]);$(this,"structureProperties",{});$(this,"structure");$(this,"expandedColumns",new Set);$(this,"expandedRows",new Map);$(this,"expandedNestedObjects",new Set);$(this,"expandedDeepNested",new Set);$(this,"expandedNestedArrays",new Map);$(this,"expandedVeryDeepNested",new Set);$(this,"resizingColumn",null);$(this,"startX",0);$(this,"startWidth",0);$(this,"wasExpanded",!1);$(this,"nestedColumnWidths",new Map);$(this,"deepNestedColumnWidths",new Map);$(this,"veryDeepNestedColumnWidths",new Map);$(this,"ultraDeepNestedColumnWidths",new Map);$(this,"entitiesService",ie.getEntitiesService());$(this,"structureService",ie.getStructureService());$(this,"options",{rows:50,first:0,sortField:"",sortOrder:1})}mounted(){this.find();const t=this.$route.params.id,i=this.structureId||(Array.isArray(t)?t[0]:t);if(!i){this.displayAlert("Missing structure ID.");return}this.structureService.findById(i).then(o=>{this.structure=o,this.structureProperties=o.entityDefinition.properties;for(const r of this.structureProperties)if(r){const p=r.name[0].toUpperCase()+r.name.slice(1);let h=!0;(["ref","array","object"].includes(r.type.type)||r.type.type==="string"&&xe.hasDecorator("Text",r.decorators))&&(h=!1);const g=["ref","array","object"].includes(r.type.type),s={header:p,field:r.name,sortable:h,width:r.name==="id"?220:g?240:h?120:160,isCollapsable:g||(r==null?void 0:r.name)==="addresses"||(r==null?void 0:r.name)==="pet",expandedWidth:g?600:null};this.headers.push(s),this.keys.push(r.name)}this.find()}).catch(o=>{Be("Error during structure retrieval: %O",o),this.displayAlert(o.message)})}beforeUnmount(){document.removeEventListener("mousemove",this.onColumnResize),document.removeEventListener("mouseup",this.stopColumnResize),document.removeEventListener("mousemove",this.onNestedColumnResize),document.removeEventListener("mouseup",this.stopNestedColumnResize),document.removeEventListener("mousemove",this.onDeepNestedColumnResize),document.removeEventListener("mouseup",this.stopDeepNestedColumnResize),document.removeEventListener("mousemove",this.onVeryDeepNestedColumnResize),document.removeEventListener("mouseup",this.stopVeryDeepNestedColumnResize),document.removeEventListener("mousemove",this.onUltraDeepNestedColumnResize),document.removeEventListener("mouseup",this.stopUltraDeepNestedColumnResize)}formatDate(t){return Ve.formatDate(t)}isDateField(t){var i,o;return((o=(i=xe.getPropertyDefinition(t,this.structureProperties))==null?void 0:i.type)==null?void 0:o.type)==="date"}toggleColumnExpansion(t){this.expandedColumns.has(t)?this.expandedColumns.delete(t):this.expandedColumns.add(t)}toggleRowExpansion(t,i){this.expandedRows.has(t)||this.expandedRows.set(t,new Set);const o=this.expandedRows.get(t);o.has(i)?o.delete(i):o.add(i)}isColumnExpanded(t){return this.expandedColumns.has(t)}isRowCellExpanded(t,i){var o;return((o=this.expandedRows.get(t))==null?void 0:o.has(i))||!1}get rowColors(){return le}isPrimitiveArray(t){var r,p;const i=this.structureProperties.find(h=>h.name===t);if(!i||((r=i.type)==null?void 0:r.type)!=="array")return!1;const o=(p=i.type.contains)==null?void 0:p.type;return["string","number","boolean","date"].includes(o)}isNestedPrimitiveArray(t,i){var h,g;const r=this.getNestedProperties(t).find(s=>s.name===i);if(!r||((h=r.type)==null?void 0:h.type)!=="array")return!1;const p=(g=r.type.contains)==null?void 0:g.type;return["string","number","boolean","date"].includes(p)}isDeepNestedPrimitiveArray(t,i,o){var n,l;const r=this.getDeepNestedProperties(t,i,o);if(!r||r.length===0||!this.structureProperties.find(d=>d.name===t))return!1;const g=this.getNestedObjectProperties(t,i).find(d=>d.name===o);if(!g||((n=g.type)==null?void 0:n.type)!=="array")return!1;const s=(l=g.type.contains)==null?void 0:l.type;return["string","number","boolean","date"].includes(s)}getNestedProperties(t){var p,h,g,s,n,l;const i=this.structureProperties.find(d=>d.name===t);if(!i)return[];const o=(p=i.type)==null?void 0:p.type;let r=[];if(o==="object")r=((h=i.type)==null?void 0:h.properties)||[];else if(o==="array"){const d=(g=i.type.contains)==null?void 0:g.type;if(d==="union"){const b=((s=i.type.contains)==null?void 0:s.types)||[],c=new Map;b.forEach(f=>{f.type==="object"&&f.properties&&f.properties.forEach(w=>{c.has(w.name)||c.set(w.name,w)})}),r=Array.from(c.values())}else if(d==="object"){const b=((n=i.type.contains)==null?void 0:n.properties)||[],c=new Map;b.forEach(f=>{c.set(f.name,f)});for(const f of this.items){const w=f[t];if(Array.isArray(w))for(const C of w)C&&typeof C=="object"&&Object.keys(C).forEach(x=>{if(!c.has(x)){const T=C[x],v=Array.isArray(T)?"array":typeof T;c.set(x,{name:x,type:{type:v}})}})}r=Array.from(c.values())}}if(r.length>0){const d=[...r],b=d.findIndex(f=>f.name==="type");if(b>0){const f=d.splice(b,1)[0];d.unshift(f)}const c=d.findIndex(f=>f.name==="name");if(c>0){const f=d.splice(c,1)[0],w=((l=d[0])==null?void 0:l.name)==="type"?1:0;d.splice(w,0,f)}return d.map(f=>{var T,v,z,E,k;const w=((T=f.type)==null?void 0:T.type)==="array",C=(z=(v=f.type)==null?void 0:v.contains)==null?void 0:z.type,x=w&&(C==="union"||C==="object"&&((E=f.type.contains)==null?void 0:E.properties));return{...f,isObject:((k=f.type)==null?void 0:k.type)==="object",isArray:x,isUnionArray:w&&C==="union"}})}return[]}toggleNestedObjectExpansion(t,i){const o=`${t}.${i}`;this.expandedNestedObjects.has(o)?this.expandedNestedObjects.delete(o):this.expandedNestedObjects.add(o)}isNestedObjectExpanded(t,i){return this.expandedNestedObjects.has(`${t}.${i}`)}toggleDeepNestedExpansion(t,i,o){const r=`${t}.${i}.${o}`;this.expandedDeepNested.has(r)?this.expandedDeepNested.delete(r):this.expandedDeepNested.add(r)}isDeepNestedExpanded(t,i,o){return this.expandedDeepNested.has(`${t}.${i}.${o}`)}toggleVeryDeepNestedExpansion(t,i,o,r){const p=`${t}.${i}.${o}.${r}`;this.expandedVeryDeepNested.has(p)?this.expandedVeryDeepNested.delete(p):this.expandedVeryDeepNested.add(p)}isVeryDeepNestedExpanded(t,i,o,r){return this.expandedVeryDeepNested.has(`${t}.${i}.${o}.${r}`)}getVeryDeepNestedProperties(t,i,o,r){var n,l,d,b,c;const h=this.getDeepNestedProperties(t,i,o).find(f=>f.name===r);if(!h)return[];let g=[];const s=(n=h.type)==null?void 0:n.type;if(s==="array"){const f=(l=h.type.contains)==null?void 0:l.type;if(f==="union"){const w=((d=h.type.contains)==null?void 0:d.types)||[],C=new Map;w.forEach(x=>{x.type==="object"&&x.properties&&x.properties.forEach(T=>{C.has(T.name)||C.set(T.name,T)})}),g=Array.from(C.values())}else f==="object"&&(g=((b=h.type.contains)==null?void 0:b.properties)||[])}else s==="object"&&(g=((c=h.type)==null?void 0:c.properties)||[]);if(g.length>0){const f=[...g],w=f.findIndex(C=>C.name==="type");if(w>0){const C=f.splice(w,1)[0];f.unshift(C)}return f.map(C=>({name:C.name,...C}))}return g.map(f=>({name:f.name,...f}))}toggleNestedArrayExpansion(t,i,o){this.expandedNestedArrays.has(t)||this.expandedNestedArrays.set(t,new Map);const r=this.expandedNestedArrays.get(t);r.has(i)||r.set(i,new Set);const p=r.get(i);p.has(o)?p.delete(o):p.add(o)}isNestedArrayExpanded(t,i,o){var r,p;return((p=(r=this.expandedNestedArrays.get(t))==null?void 0:r.get(i))==null?void 0:p.has(o))||!1}getDeepNestedProperties(t,i,o){var c,f,w,C,x,T,v,z,E,k,A,N,W;const r=this.structureProperties.find(M=>M.name===t);if(!r)return[];const p=(c=r.type)==null?void 0:c.type;let h=[];p==="object"?h=((f=r.type)==null?void 0:f.properties)||[]:p==="array"&&((w=r.type.contains)==null?void 0:w.type)==="object"&&(h=((C=r.type.contains)==null?void 0:C.properties)||[]);const g=h.find(M=>M.name===i);if(!g)return[];let s=[];const n=(x=g.type)==null?void 0:x.type;n==="object"?s=((T=g.type)==null?void 0:T.properties)||[]:n==="array"&&((v=g.type.contains)==null?void 0:v.type)==="object"&&(s=((z=g.type.contains)==null?void 0:z.properties)||[]);const l=s.find(M=>M.name===o);if(!l)return[];let d=[];const b=(E=l.type)==null?void 0:E.type;if(b==="object")d=((k=l.type)==null?void 0:k.properties)||[];else if(b==="array"){const M=(A=l.type.contains)==null?void 0:A.type;if(M==="object")d=((N=l.type.contains)==null?void 0:N.properties)||[];else if(M==="union"){const _=((W=l.type.contains)==null?void 0:W.types)||[],L=new Map;_.forEach(Z=>{Z.type==="object"&&Z.properties&&Z.properties.forEach(Q=>{L.has(Q.name)||L.set(Q.name,Q)})}),d=Array.from(L.values())}}return d.map(M=>{var _;return{name:M.name,type:M.type,isArray:((_=M.type)==null?void 0:_.type)==="array",...M}})}getNestedObjectProperties(t,i){var n,l,d,b,c,f,w,C;const o=this.structureProperties.find(x=>x.name===t);if(!o)return[];const r=(n=o.type)==null?void 0:n.type;let p=[];r==="object"?p=((l=o.type)==null?void 0:l.properties)||[]:r==="array"&&((d=o.type.contains)==null?void 0:d.type)==="object"&&(p=((b=o.type.contains)==null?void 0:b.properties)||[]);const h=p.find(x=>x.name===i);if(!h)return[];let g=[];const s=(c=h.type)==null?void 0:c.type;return s==="object"?g=((f=h.type)==null?void 0:f.properties)||[]:s==="array"&&((w=h.type.contains)==null?void 0:w.type)==="object"&&(g=((C=h.type.contains)==null?void 0:C.properties)||[]),g.map(x=>{var z,E,k;const T=((z=x.type)==null?void 0:z.type)==="array",v=(k=(E=x.type)==null?void 0:E.contains)==null?void 0:k.type;return{name:x.name,type:x.type,isArray:T,isUnionArray:T&&v==="union",...x}})}getNestedPropWidth(t,i){var r,p;const o=`${t}.${i.name}`;if((i.isObject||i.isArray)&&this.isNestedObjectExpanded(t,i.name)){const h=this.getNestedObjectProperties(t,i.name);let g=0;for(const n of h)if(((r=n.type)==null?void 0:r.type)==="array"&&this.isDeepNestedExpanded(t,i.name,n.name)){const l=this.getDeepNestedProperties(t,i.name,n.name);for(const d of l)if(((p=d.type)==null?void 0:p.type)==="array"&&this.isVeryDeepNestedExpanded(t,i.name,n.name,d.name)){const b=this.getVeryDeepNestedProperties(t,i.name,n.name,d.name);for(const c of b)g+=this.getUltraDeepNestedSubColumnWidth(t,i.name,n.name,d.name,c.name)}else g+=this.getDeepNestedSubColumnWidth(t,i.name,n.name,d.name)}else g+=this.getNestedObjectSubColumnWidth(t,i.name,n.name);const s=Math.max(g,h.length*80);if(this.nestedColumnWidths.has(o)){const n=this.nestedColumnWidths.get(o);return Math.max(n,s)}return s}return this.nestedColumnWidths.has(o)?this.nestedColumnWidths.get(o):i.name==="name"?220:i.name==="sku"?120:i.name==="productId"?80:["street","city","state"].includes(i.name)?150:["postalCode","country"].includes(i.name)?120:100}getExpandedColumnWidth(t){if(!this.isColumnExpanded(t))return 240;const i=this.getNestedProperties(t);let o=0;for(const g of i)o+=this.getNestedPropWidth(t,g);const r=i.some(g=>this.nestedColumnWidths.has(`${t}.${g.name}`));if(i.some(g=>(g.isObject||g.isArray)&&this.isNestedObjectExpanded(t,g.name)))return Math.max(o,120);const h=this.headers.find(g=>g.field===t);return h!=null&&h.expandedWidth&&!r?Math.max(h.expandedWidth,o):Math.max(o,120)}getNestedObjectSubColumnWidth(t,i,o){var h,g;const r=`${t}.${i}.${o}`;if(this.deepNestedColumnWidths.has(r))return this.deepNestedColumnWidths.get(r);if(!this.items||this.items.length===0)return 80;let p=o.length;for(const s of this.items){const n=(h=s[t])==null?void 0:h[i];let l;if(Array.isArray(n)&&n.length>0?l=(g=n[0])==null?void 0:g[o]:l=n==null?void 0:n[o],l!=null){const d=String(l);p=Math.max(p,d.length)}}return Math.max(Math.min(p*9+40,300),100)}getDeepNestedSubColumnWidth(t,i,o,r){var g;const p=`${t}.${i}.${o}.${r}`;if(this.veryDeepNestedColumnWidths.has(p))return this.veryDeepNestedColumnWidths.get(p);if(!this.items||this.items.length===0)return 80;let h=r.length;for(const s of this.items){const n=(g=s[t])==null?void 0:g[i];if(Array.isArray(n)&&n.length>0){const l=n[0],d=l==null?void 0:l[o];if(Array.isArray(d))for(const b of d){const c=b==null?void 0:b[r];if(c!=null){const f=Array.isArray(c)?`[${c.length} items]`:String(c);h=Math.max(h,f.length)}}}}return Math.max(Math.min(h*9+40,300),100)}getUltraDeepNestedSubColumnWidth(t,i,o,r,p){const h=`${t}.${i}.${o}.${r}.${p}`;return this.ultraDeepNestedColumnWidths.has(h)?this.ultraDeepNestedColumnWidths.get(h):Math.max(Math.min(p.length*9+32,360),100)}get allColumns(){const t=[];for(const i of this.headers)if(this.isColumnExpanded(i.field)){const o=this.getNestedProperties(i.field);for(const r of o)t.push({header:r.name,field:`${i.field}.${r.name}`,parentField:i.field,sortable:!1,width:120,isNested:!0,level:1})}else t.push(i);return t}getCellDisplayValue(t,i){const o=t[i];if(o==null)return"null";if(Array.isArray(o)){if(o.length===0)return"[]";const r=o[0];if(typeof r!="object")return o.length>1?`${r} +${o.length-1}`:String(r);if(this.isKeyValueObject(r)&&r.key!==void 0){const g=this.safeToString(r.key);return o.length>1?`${g} +${o.length-1}`:g}const p=(r==null?void 0:r.name)||(r==null?void 0:r.title)||(r==null?void 0:r.id);if(p)return o.length>1?`${p} +${o.length-1}`:p;const h=Object.keys(r);if(h.length>0){const g=r[h[0]];return o.length>1?`${g} +${o.length-1}`:String(g)}return o.length>1?`Item +${o.length-1}`:"Item"}else if(typeof o=="object"){const r=Object.keys(o);if(r.length===0)return"{}";for(const g of r){const s=o[g];if(Array.isArray(s)&&s.length>0){const n=s[0];if(typeof n=="object"&&n!==null){const l=Object.keys(n);if(l.length>0)return String(n[l[0]]??"Item")}}}const p=r[0],h=o[p];if(typeof h=="object"&&h!==null&&!Array.isArray(h)){const g=Object.keys(h);if(g.length>0)return String(h[g[0]]||g[0])}return String(h||p)}return String(o)}isKeyValueObject(t){return!!t&&typeof t=="object"&&"key"in t&&"value"in t}safeToString(t){if(t==null)return"";if(typeof t=="string")return t;if(typeof t=="number"||typeof t=="boolean")return String(t);try{return JSON.stringify(t)}catch{return String(t)}}getArrayPrimaryNestedProp(t){var r;const i=this.getNestedProperties(t);if(!i||i.length===0)return null;const o=["name","key","title","type","id"];for(const p of o)if(i.some(h=>(h==null?void 0:h.name)===p))return p;return((r=i[0])==null?void 0:r.name)??null}getArrayObjectLabel(t,i){if(!t||typeof t!="object")return this.safeToString(t);if(this.isKeyValueObject(t))return this.safeToString(t.key);const o=i?this.getArrayPrimaryNestedProp(i):null;if(o&&(t==null?void 0:t[o])!==void 0)return this.safeToString(t[o]);const r=(t==null?void 0:t.name)||(t==null?void 0:t.title)||(t==null?void 0:t.type)||(t==null?void 0:t.id);if(r!==void 0)return this.safeToString(r);const p=Object.keys(t);return p.length>0?this.safeToString(t[p[0]]):"Item"}getCellTitleValue(t,i){const o=t==null?void 0:t[i];if(o==null)return"";if(Array.isArray(o)){if(o.length===0)return"[]";const r=o.slice(0,12).map(h=>typeof h=="object"?this.getArrayObjectLabel(h,i):this.safeToString(h)).filter(h=>h.length>0),p=o.length>12?` â€¦(+${o.length-12})`:"";return r.join(", ")+p}if(typeof o=="object")try{return JSON.stringify(o)}catch{return String(o)}return this.safeToString(o)}getNestedPropRenderWidth(t,i,o){const r=this.getNestedPropWidth(t,i);if(!this.isColumnExpanded(t))return r;const p=this.getNestedProperties(t);if(!p||p.length===0||!(o===p.length-1))return r;const g=this.getExpandedColumnWidth(t);let s=0;for(let l=0;l<o;l++)s+=this.getNestedPropWidth(t,p[l]);const n=g-s;return n<=0?r:Math.max(r,n)}onPage(t){this.options.rows=t.rows,this.options.first=t.first,this.find()}onSort(t){this.options.sortField=t.sortField,this.options.sortOrder=t.sortOrder,this.find()}clearSearch(){this.searchText=null,this.options.first=0,this.find()}search(){this.options.first=0,this.find()}displayAlert(t){Be("Alert displayed: %s",t),window.alert(t)}startColumnResize(t,i){this.resizingColumn=i,this.startX=t.pageX,this.wasExpanded=this.isColumnExpanded(i.field),this.startWidth=this.wasExpanded?this.getExpandedColumnWidth(i.field):i.width,document.addEventListener("mousemove",this.onColumnResize),document.addEventListener("mouseup",this.stopColumnResize),document.body.style.cursor="col-resize",document.body.style.userSelect="none"}onColumnResize(t){if(!this.resizingColumn)return;const i=t.pageX-this.startX,o=Math.max(50,this.startWidth+i);this.wasExpanded?this.resizingColumn.expandedWidth=o:this.resizingColumn.width=o}stopColumnResize(){document.removeEventListener("mousemove",this.onColumnResize),document.removeEventListener("mouseup",this.stopColumnResize),document.body.style.cursor="",document.body.style.userSelect="",this.resizingColumn=null}startNestedColumnResize(t,i,o){this.resizingColumn={parentField:i,nestedProp:o},this.startX=t.pageX,this.startWidth=this.getNestedPropWidth(i,o),document.addEventListener("mousemove",this.onNestedColumnResize),document.addEventListener("mouseup",this.stopNestedColumnResize),document.body.style.cursor="col-resize",document.body.style.userSelect="none"}onNestedColumnResize(t){if(!this.resizingColumn||!this.resizingColumn.nestedProp)return;const i=t.pageX-this.startX,o=Math.max(80,this.startWidth+i),r=`${this.resizingColumn.parentField}.${this.resizingColumn.nestedProp.name}`;this.nestedColumnWidths.set(r,o);const p=this.resizingColumn.parentField,h=this.headers.find(g=>g.field===p);if(h){const g=this.getNestedProperties(p);let s=0;for(const n of g)s+=this.getNestedPropWidth(p,n);h.expandedWidth=s}}stopNestedColumnResize(){document.removeEventListener("mousemove",this.onNestedColumnResize),document.removeEventListener("mouseup",this.stopNestedColumnResize),document.body.style.cursor="",document.body.style.userSelect="",this.resizingColumn=null}startDeepNestedColumnResize(t,i,o,r){this.resizingColumn={parentField:i,nestedProp:o,deepProp:r,level:"deep"},this.startX=t.pageX,this.startWidth=this.getNestedObjectSubColumnWidth(i,o,r.name),document.addEventListener("mousemove",this.onDeepNestedColumnResize),document.addEventListener("mouseup",this.stopDeepNestedColumnResize),document.body.style.cursor="col-resize",document.body.style.userSelect="none"}onDeepNestedColumnResize(t){if(!this.resizingColumn||this.resizingColumn.level!=="deep")return;const i=t.pageX-this.startX,o=Math.max(80,this.startWidth+i),r=`${this.resizingColumn.parentField}.${this.resizingColumn.nestedProp}.${this.resizingColumn.deepProp.name}`;this.deepNestedColumnWidths.set(r,o);const p=`${this.resizingColumn.parentField}.${this.resizingColumn.nestedProp}`,h=this.resizingColumn.parentField,g=this.resizingColumn.nestedProp,s=this.getNestedObjectProperties(h,g);let n=0;for(const d of s)n+=this.getNestedObjectSubColumnWidth(h,g,d.name);this.nestedColumnWidths.set(p,n);const l=this.headers.find(d=>d.field===h);if(l){const d=this.getNestedProperties(h);let b=0;for(const c of d)b+=this.getNestedPropWidth(h,c);l.expandedWidth=b,l.width=b}}stopDeepNestedColumnResize(){document.removeEventListener("mousemove",this.onDeepNestedColumnResize),document.removeEventListener("mouseup",this.stopDeepNestedColumnResize),document.body.style.cursor="",document.body.style.userSelect="",this.resizingColumn=null}startVeryDeepNestedColumnResize(t,i,o,r,p){this.resizingColumn={parentField:i,nestedProp:o,deepProp:r,veryDeepProp:p,level:"veryDeep"},this.startX=t.pageX,this.startWidth=this.getDeepNestedSubColumnWidth(i,o,r,p.name),document.addEventListener("mousemove",this.onVeryDeepNestedColumnResize),document.addEventListener("mouseup",this.stopVeryDeepNestedColumnResize),document.body.style.cursor="col-resize",document.body.style.userSelect="none"}onVeryDeepNestedColumnResize(t){if(!this.resizingColumn||this.resizingColumn.level!=="veryDeep")return;const i=t.pageX-this.startX,o=Math.max(80,this.startWidth+i),r=`${this.resizingColumn.parentField}.${this.resizingColumn.nestedProp}.${this.resizingColumn.deepProp}.${this.resizingColumn.veryDeepProp.name}`;this.veryDeepNestedColumnWidths.set(r,o),this.updateParentWidthsAfterDeepResize(this.resizingColumn.parentField,this.resizingColumn.nestedProp,this.resizingColumn.deepProp)}stopVeryDeepNestedColumnResize(){document.removeEventListener("mousemove",this.onVeryDeepNestedColumnResize),document.removeEventListener("mouseup",this.stopVeryDeepNestedColumnResize),document.body.style.cursor="",document.body.style.userSelect="",this.resizingColumn=null}startUltraDeepNestedColumnResize(t,i,o,r,p,h){this.resizingColumn={parentField:i,nestedProp:o,deepProp:r,veryDeepProp:p,ultraDeepProp:h,level:"ultraDeep"},this.startX=t.pageX,this.startWidth=this.getUltraDeepNestedSubColumnWidth(i,o,r,p,h.name),document.addEventListener("mousemove",this.onUltraDeepNestedColumnResize),document.addEventListener("mouseup",this.stopUltraDeepNestedColumnResize),document.body.style.cursor="col-resize",document.body.style.userSelect="none"}onUltraDeepNestedColumnResize(t){if(!this.resizingColumn||this.resizingColumn.level!=="ultraDeep")return;const i=t.pageX-this.startX,o=Math.max(80,this.startWidth+i),r=`${this.resizingColumn.parentField}.${this.resizingColumn.nestedProp}.${this.resizingColumn.deepProp}.${this.resizingColumn.veryDeepProp}.${this.resizingColumn.ultraDeepProp.name}`;this.ultraDeepNestedColumnWidths.set(r,o),this.updateParentWidthsAfterDeepResize(this.resizingColumn.parentField,this.resizingColumn.nestedProp,this.resizingColumn.deepProp)}stopUltraDeepNestedColumnResize(){document.removeEventListener("mousemove",this.onUltraDeepNestedColumnResize),document.removeEventListener("mouseup",this.stopUltraDeepNestedColumnResize),document.body.style.cursor="",document.body.style.userSelect="",this.resizingColumn=null}updateParentWidthsAfterDeepResize(t,i,o){var d;const r=`${t}.${i}.${o}`,p=this.getDeepNestedProperties(t,i,o);let h=0;for(const b of p)if(((d=b.type)==null?void 0:d.type)==="array"&&this.isVeryDeepNestedExpanded(t,i,o,b.name)){const c=this.getVeryDeepNestedProperties(t,i,o,b.name);h+=c.reduce((f,w)=>f+this.getUltraDeepNestedSubColumnWidth(t,i,o,b.name,w.name),0)}else h+=this.getDeepNestedSubColumnWidth(t,i,o,b.name);this.deepNestedColumnWidths.set(r,h);const g=`${t}.${i}`,s=this.getNestedObjectProperties(t,i);let n=0;for(const b of s)n+=this.getNestedObjectSubColumnWidth(t,i,b.name);this.nestedColumnWidths.set(g,n);const l=this.headers.find(b=>b.field===t);if(l){const b=this.getNestedProperties(t);let c=0;for(const f of b)c+=this.getNestedPropWidth(t,f);l.expandedWidth=c}}find(){var g;if(this.loading)return;this.loading=!0;const t=this.options.first/this.options.rows,i=[];this.options.sortField&&i.push(new Xe(this.options.sortField,this.options.sortOrder===1?we.ASC:we.DESC));const o=qe.create(t,this.options.rows,{orders:i}),r=this.$route.params.id,p=this.structureId||(Array.isArray(r)?r[0]:r);((g=this.searchText)!=null&&g.length?this.entitiesService.search(p,this.searchText,o):this.entitiesService.findAll(p,o)).then(s=>{this.items=s.content??[],this.totalItems=s.totalElements??0,this.loading=!1,this.finishedInitialLoad||setTimeout(()=>{this.finishedInitialLoad=!0},500)}).catch(s=>{this.displayAlert(s.message),this.loading=!1,this.finishedInitialLoad||setTimeout(()=>{this.finishedInitialLoad=!0},500)})}};Ye([se({type:String})],$e.prototype,"structureId",2);$e=Ye([be({components:{DataTable:Me,Column:We,Toolbar:ke,Button:ce,InputText:Ne}})],$e);const Jt=$e,Gt={class:"w-full h-full flex flex-col"},Zt={class:"flex-1 overflow-auto relative",style:{"min-height":"0"}},Qt={class:"w-full border-collapse table-fixed",style:{"box-sizing":"border-box"}},Yt={class:"sticky top-0 z-10"},Pt={style:{"background-color":"#101010"}},es={class:"flex items-center gap-1 h-full px-2 min-w-0 overflow-hidden"},ts=["onClick"],ss={key:0,width:"7",height:"4",viewBox:"0 0 7 4",fill:"none",xmlns:"http://www.w3.org/2000/svg"},ns={key:1,width:"4",height:"7",viewBox:"0 0 4 7",fill:"none",xmlns:"http://www.w3.org/2000/svg"},is=["title","onClick"],os=["onMousedown"],rs={key:0,class:"flex w-full h-full"},ls={class:"flex items-center gap-1 min-w-0 overflow-hidden w-full"},as=["onClick"],ds={key:0,width:"7",height:"4",viewBox:"0 0 7 4",fill:"none",xmlns:"http://www.w3.org/2000/svg"},us={key:1,width:"4",height:"7",viewBox:"0 0 4 7",fill:"none",xmlns:"http://www.w3.org/2000/svg"},cs=["title","onClick"],ps=["onMousedown"],ms={key:1,style:{"background-color":"#FAE8FF"}},hs={key:0,class:"flex w-full h-full"},fs={key:0,class:"flex w-full h-full"},ys={class:"flex items-center gap-1 h-full min-w-0 overflow-hidden w-full"},gs=["onClick"],bs={key:0,width:"7",height:"4",viewBox:"0 0 7 4",fill:"none",xmlns:"http://www.w3.org/2000/svg"},vs={key:1,width:"4",height:"7",viewBox:"0 0 4 7",fill:"none",xmlns:"http://www.w3.org/2000/svg"},ws=["title","onClick"],xs=["onMousedown"],Cs={key:2,style:{"background-color":"#EDE9FE"}},$s={key:0,class:"flex w-full h-full"},ks={key:0,class:"flex w-full h-full"},Ns={key:0,class:"flex w-full h-full"},Ss={class:"flex items-center gap-1 h-full min-w-0 overflow-hidden w-full"},As=["onClick"],Es={key:0,width:"7",height:"4",viewBox:"0 0 7 4",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Ds={key:1,width:"4",height:"7",viewBox:"0 0 4 7",fill:"none",xmlns:"http://www.w3.org/2000/svg"},js=["title","onClick"],zs=["onMousedown"],Ws={key:3,style:{"background-color":"#7dd3fc"}},Ms={key:0,class:"flex w-full"},Os={key:0,class:"flex w-full h-full"},Ts={key:0,class:"flex w-full h-full"},Vs=["title"],Rs=["onMousedown"],_s={class:"h-full flex items-stretch"},Ls={class:"flex-1"},Fs={key:0},Bs={class:"flex flex-col"},Us=["title","onClick"],Is={class:"px-2 flex items-center justify-between"},Hs={class:"truncate"},Ks={key:0,class:"text-gray-500 ml-2 flex-shrink-0"},Xs={key:1,class:"px-3 py-2"},qs=["title","onClick"],Js={class:"truncate"},Gs={key:0,class:"text-gray-500 ml-2 flex-shrink-0"},Zs={key:0,class:"flex w-full"},Qs={class:"flex flex-col w-full"},Ys=["title","onClick"],Ps={class:"truncate"},en={key:0,class:"text-gray-500 ml-2 flex-shrink-0"},tn={key:1,class:"flex w-full h-[-webkit-fill-available]"},sn=["title","onClick"],nn={class:"truncate"},on={key:0,class:"text-gray-500 ml-2 flex-shrink-0"},rn={key:2,class:"flex w-full h-[-webkit-fill-available]"},ln={key:0,class:"flex w-full h-full"},an={key:0,class:"flex w-full h-full"},dn=["onClick"],un={class:"flex flex-col w-full"},cn=["title"],pn={class:"truncate"},mn={key:0,class:"text-gray-500 ml-2 flex-shrink-0"},hn={key:1,class:"text-gray-500 ml-2 flex-shrink-0"},fn={class:"flex flex-col"},yn=["onClick"],gn={key:0,class:"flex flex-col"},bn=["title"],vn={class:"truncate"},wn={key:0,class:"text-gray-500 ml-2 flex-shrink-0"},xn=["title"],Cn={class:"truncate"},$n={key:0,class:"text-gray-500 ml-2 flex-shrink-0"},kn={key:1,class:"text-gray-500 ml-2 flex-shrink-0"},Nn=["title","onClick"],Sn={class:"truncate"},An={key:0,class:"text-gray-500 ml-2 flex-shrink-0"},En={key:1,class:"flex flex-col"},Dn=["onClick"],jn=["title"],zn={key:0,class:"text-gray-500 ml-2 flex-shrink-0"},Wn={key:2,class:"flex w-full h-full"},Mn=["title"],On=["title","onClick"],Tn={key:1,class:"flex w-full h-full"},Vn=["title"],Rn=["title"],_n={key:0,class:"bg-gray-50"},Ln={class:"flex flex-col"},Fn=["onClick"],Bn={class:"px-2 flex items-center justify-between"},Un=["title"],In=["title"],Hn={key:2,class:"text-gray-500 ml-2 flex-shrink-0"},Kn=["title"],Xn={key:1,class:"px-2 py-2"},qn=["title","onClick"],Jn={key:0,class:"p-8 text-center"},Gn={key:1,class:"absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center"},Zn={class:"border-t border-gray-300 p-3 flex items-center justify-between bg-white flex-shrink-0"},Qn={class:"text-sm text-gray-600"},Yn={class:"flex gap-2"};function Pn(e,m,t,i,o,r){const p=Ne,h=ce,g=ke;return a(),u("div",Gt,[R(g,{class:"!w-full flex-shrink-0"},{start:B(()=>[R(p,{modelValue:e.searchText,"onUpdate:modelValue":m[0]||(m[0]=s=>e.searchText=s),placeholder:"Search",onKeyup:Je(e.search,["enter"]),onFocus:m[1]||(m[1]=s=>{var n;return(n=s.target)==null?void 0:n.select()}),class:"w-1/2"},null,8,["modelValue","onKeyup"]),e.searchText?(a(),ee(h,{key:0,icon:"pi pi-times",class:"ml-2",onClick:e.clearSearch},null,8,["onClick"])):D("",!0)]),_:1}),y("div",Zt,[y("table",Qt,[y("thead",Yt,[y("tr",Pt,[(a(!0),u(j,null,O(e.headers,s=>(a(),u("th",{key:s.field,style:V([{width:(e.isColumnExpanded(s.field)?e.getExpandedColumnWidth(s.field):s.width)+"px",maxWidth:(e.isColumnExpanded(s.field)?e.getExpandedColumnWidth(s.field):s.width)+"px",boxSizing:"border-box",position:"relative",height:"38px"},{border:"1px solid #28282B"}]),class:"px-0 py-0 text-left text-xs font-medium text-white"},[y("div",es,[s.isCollapsable&&!e.isPrimitiveArray(s.field)?(a(),u("span",{key:0,class:"flex-shrink-0 cursor-pointer",onClick:I(n=>e.toggleColumnExpansion(s.field),["stop"])},[e.isColumnExpanded(s.field)?(a(),u("svg",ss,m[4]||(m[4]=[y("path",{d:"M1 0.5L3.5 3L6 0.5",stroke:"#9B87F5","stroke-width":"1","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))):(a(),u("svg",ns,m[5]||(m[5]=[y("path",{d:"M0.5 1L3 3.5L0.5 6",stroke:"#9B87F5","stroke-width":"1","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])))],8,ts)):D("",!0),y("span",{class:J(["truncate-text flex-1",{"cursor-pointer":s.isCollapsable&&!e.isPrimitiveArray(s.field)}]),title:s.header,onClick:I(n=>s.isCollapsable&&!e.isPrimitiveArray(s.field)?e.toggleColumnExpansion(s.field):null,["stop"])},S(s.header),11,is),y("div",{class:"resize-handle",onMousedown:I(n=>e.startColumnResize(n,s),["stop","prevent"]),title:"Drag to resize"},null,40,os)])],4))),128))]),e.headers.some(s=>e.isColumnExpanded(s.field)&&!e.isPrimitiveArray(s.field))?(a(),u("tr",{key:0,style:V({backgroundColor:e.rowColors[0].header})},[(a(!0),u(j,null,O(e.headers,s=>(a(),u("th",{key:"sub-"+s.field,style:V([{width:(e.isColumnExpanded(s.field)?e.getExpandedColumnWidth(s.field):s.width)+"px",maxWidth:(e.isColumnExpanded(s.field)?e.getExpandedColumnWidth(s.field):s.width)+"px",boxSizing:"border-box",flexShrink:"0",height:"29px"},{border:"1px solid white"}]),class:"px-0 py-0 text-left text-xs font-medium"},[e.isColumnExpanded(s.field)?(a(),u("div",rs,[(a(!0),u(j,null,O(e.getNestedProperties(s.field),(n,l)=>(a(),u("div",{key:`${s.field}.${n.name}`,class:"px-2 py-1 border-r last:border-r-0 border-white relative",style:V({width:e.getNestedPropRenderWidth(s.field,n,l)+"px",minWidth:"80px",boxSizing:"border-box",flexShrink:"0",height:"29px",display:"flex",alignItems:"center"})},[y("div",ls,[(n.isObject||n.isArray)&&!e.isNestedPrimitiveArray(s.field,n.name)?(a(),u("span",{key:0,class:"flex-shrink-0 cursor-pointer",onClick:I(d=>e.toggleNestedObjectExpansion(s.field,n.name),["stop"])},[e.isNestedObjectExpanded(s.field,n.name)?(a(),u("svg",ds,m[6]||(m[6]=[y("path",{d:"M1 0.5L3.5 3L6 0.5",stroke:"#AFB0B8","stroke-width":"1","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))):(a(),u("svg",us,m[7]||(m[7]=[y("path",{d:"M0.5 1L3 3.5L0.5 6",stroke:"#AFB0B8","stroke-width":"1","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])))],8,as)):D("",!0),y("span",{class:J(["truncate-text text-xs flex-1",{"cursor-pointer":(n.isObject||n.isArray)&&!e.isNestedPrimitiveArray(s.field,n.name)}]),title:n.name,onClick:I(d=>(n.isObject||n.isArray)&&!e.isNestedPrimitiveArray(s.field,n.name)?e.toggleNestedObjectExpansion(s.field,n.name):null,["stop"])},S(n.name),11,cs),y("div",{class:"resize-handle",onMousedown:I(d=>e.startNestedColumnResize(d,s.field,n),["stop","prevent"]),title:"Drag to resize"},null,40,ps)])],4))),128))])):D("",!0)],4))),128))],4)):D("",!0),e.headers.some(s=>e.isColumnExpanded(s.field)&&!e.isPrimitiveArray(s.field)&&e.getNestedProperties(s.field).some(n=>e.isNestedObjectExpanded(s.field,n.name)))?(a(),u("tr",ms,[(a(!0),u(j,null,O(e.headers,s=>(a(),u("th",{key:"subsub-"+s.field,style:V([{width:(e.isColumnExpanded(s.field)?e.getExpandedColumnWidth(s.field):s.width)+"px",maxWidth:(e.isColumnExpanded(s.field)?e.getExpandedColumnWidth(s.field):s.width)+"px",boxSizing:"border-box",flexShrink:"0",height:"29px"},{border:"1px solid white"}]),class:"px-0 py-0 text-left text-xs font-medium"},[e.isColumnExpanded(s.field)?(a(),u("div",hs,[(a(!0),u(j,null,O(e.getNestedProperties(s.field),(n,l)=>(a(),u("div",{key:`${s.field}.${n.name}`,class:"border-r last:border-r-0 border-white",style:V({width:e.getNestedPropRenderWidth(s.field,n,l)+"px",minWidth:"80px",boxSizing:"border-box",flexShrink:"0"})},[e.isNestedObjectExpanded(s.field,n.name)?(a(),u("div",fs,[(a(!0),u(j,null,O(e.getNestedObjectProperties(s.field,n.name),d=>{var b,c,f,w;return a(),u("div",{key:`${s.field}.${n.name}.${d.name}`,class:"px-2 py-1 border-r last:border-r-0 border-white relative",style:V({width:(e.isDeepNestedExpanded(s.field,n.name,d.name)?e.getDeepNestedProperties(s.field,n.name,d.name).reduce((x,T)=>{var v;if(((v=T.type)==null?void 0:v.type)==="array"&&e.isVeryDeepNestedExpanded(s.field,n.name,d.name,T.name)){const z=e.getVeryDeepNestedProperties(s.field,n.name,d.name,T.name);return x+z.reduce((E,k)=>E+e.getUltraDeepNestedSubColumnWidth(s.field,n.name,d.name,T.name,k.name),0)}return x+e.getDeepNestedSubColumnWidth(s.field,n.name,d.name,T.name)},0):e.getNestedObjectSubColumnWidth(s.field,n.name,d.name))+"px",minWidth:"100px",height:"29px",flexShrink:"0"})},[y("div",ys,[(((b=d.type)==null?void 0:b.type)==="array"||((c=d.type)==null?void 0:c.type)==="object")&&!e.isDeepNestedPrimitiveArray(s.field,n.name,d.name)?(a(),u("span",{key:0,class:"flex-shrink-0 cursor-pointer",onClick:I(C=>e.toggleDeepNestedExpansion(s.field,n.name,d.name),["stop"])},[e.isDeepNestedExpanded(s.field,n.name,d.name)?(a(),u("svg",bs,m[8]||(m[8]=[y("path",{d:"M1 0.5L3.5 3L6 0.5",stroke:"#AFB0B8","stroke-width":"1","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))):(a(),u("svg",vs,m[9]||(m[9]=[y("path",{d:"M0.5 1L3 3.5L0.5 6",stroke:"#AFB0B8","stroke-width":"1","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])))],8,gs)):D("",!0),y("span",{class:J(["truncate text-xs text-surface-900 flex-1",{"cursor-pointer":(((f=d.type)==null?void 0:f.type)==="array"||((w=d.type)==null?void 0:w.type)==="object")&&!e.isDeepNestedPrimitiveArray(s.field,n.name,d.name)}]),title:d.name,onClick:I(C=>{var x,T;return(((x=d.type)==null?void 0:x.type)==="array"||((T=d.type)==null?void 0:T.type)==="object")&&!e.isDeepNestedPrimitiveArray(s.field,n.name,d.name)?e.toggleDeepNestedExpansion(s.field,n.name,d.name):null},["stop"])},S(d.name),11,ws),y("div",{class:"resize-handle",onMousedown:I(C=>e.startDeepNestedColumnResize(C,s.field,n.name,d),["stop","prevent"]),title:"Drag to resize"},null,40,xs)])],4)}),128))])):D("",!0)],4))),128))])):D("",!0)],4))),128))])):D("",!0),e.headers.some(s=>e.isColumnExpanded(s.field)&&e.getNestedProperties(s.field).some(n=>e.isNestedObjectExpanded(s.field,n.name)&&e.getNestedObjectProperties(s.field,n.name).some(l=>e.isDeepNestedExpanded(s.field,n.name,l.name))))?(a(),u("tr",Cs,[(a(!0),u(j,null,O(e.headers,s=>(a(),u("th",{key:"deep-"+s.field,style:V([{width:(e.isColumnExpanded(s.field)?e.getExpandedColumnWidth(s.field):s.width)+"px",maxWidth:(e.isColumnExpanded(s.field)?e.getExpandedColumnWidth(s.field):s.width)+"px",boxSizing:"border-box",flexShrink:"0",height:"29px"},{border:"1px solid white"}]),class:"px-0 py-0 text-left text-xs font-medium"},[e.isColumnExpanded(s.field)?(a(),u("div",$s,[(a(!0),u(j,null,O(e.getNestedProperties(s.field),(n,l)=>(a(),u("div",{key:`${s.field}.${n.name}`,class:"border-r last:border-r-0 border-white",style:V({width:e.getNestedPropRenderWidth(s.field,n,l)+"px",minWidth:"80px",boxSizing:"border-box",flexShrink:"0"})},[e.isNestedObjectExpanded(s.field,n.name)?(a(),u("div",ks,[(a(!0),u(j,null,O(e.getNestedObjectProperties(s.field,n.name),d=>(a(),u("div",{key:`${s.field}.${n.name}.${d.name}`,class:"border-r last:border-r-0 border-white",style:V({width:(e.isDeepNestedExpanded(s.field,n.name,d.name)?e.getDeepNestedProperties(s.field,n.name,d.name).reduce((c,f)=>{var w;if(((w=f.type)==null?void 0:w.type)==="array"&&e.isVeryDeepNestedExpanded(s.field,n.name,d.name,f.name)){const C=e.getVeryDeepNestedProperties(s.field,n.name,d.name,f.name);return c+C.reduce((x,T)=>x+e.getUltraDeepNestedSubColumnWidth(s.field,n.name,d.name,f.name,T.name),0)}return c+e.getDeepNestedSubColumnWidth(s.field,n.name,d.name,f.name)},0):e.getNestedObjectSubColumnWidth(s.field,n.name,d.name))+"px",minWidth:"80px",boxSizing:"border-box",flexShrink:"0"})},[e.isDeepNestedExpanded(s.field,n.name,d.name)?(a(),u("div",Ns,[(a(!0),u(j,null,O(e.getDeepNestedProperties(s.field,n.name,d.name),b=>{var c,f,w,C,x,T,v,z,E,k,A,N,W,M,_,L,Z,Q;return a(),u("div",{key:`${s.field}.${n.name}.${d.name}.${b.name}`,class:"px-2 py-1 border-r last:border-r-0 border-white relative",style:V({width:(()=>{var Y;return((Y=b.type)==null?void 0:Y.type)==="array"&&e.isVeryDeepNestedExpanded(s.field,n.name,d.name,b.name)?e.getVeryDeepNestedProperties(s.field,n.name,d.name,b.name).reduce((H,U)=>H+e.getUltraDeepNestedSubColumnWidth(s.field,n.name,d.name,b.name,U.name),0):e.getDeepNestedSubColumnWidth(s.field,n.name,d.name,b.name)})()+"px",minWidth:"100px",flexShrink:"0",boxSizing:"border-box"})},[y("div",Ss,[((c=b.type)==null?void 0:c.type)==="array"&&((w=(f=b.type)==null?void 0:f.contains)==null?void 0:w.type)!=="string"&&((x=(C=b.type)==null?void 0:C.contains)==null?void 0:x.type)!=="number"&&((v=(T=b.type)==null?void 0:T.contains)==null?void 0:v.type)!=="boolean"&&((E=(z=b.type)==null?void 0:z.contains)==null?void 0:E.type)!=="date"?(a(),u("span",{key:0,class:"flex-shrink-0 cursor-pointer",onClick:I(Y=>e.toggleVeryDeepNestedExpansion(s.field,n.name,d.name,b.name),["stop"])},[e.isVeryDeepNestedExpanded(s.field,n.name,d.name,b.name)?(a(),u("svg",Es,m[10]||(m[10]=[y("path",{d:"M1 0.5L3.5 3L6 0.5",stroke:"#AFB0B8","stroke-width":"1","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))):(a(),u("svg",Ds,m[11]||(m[11]=[y("path",{d:"M0.5 1L3 3.5L0.5 6",stroke:"#AFB0B8","stroke-width":"1","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])))],8,As)):D("",!0),y("span",{class:J(["truncate text-xs text-surface-900 flex-1",{"cursor-pointer":((k=b.type)==null?void 0:k.type)==="array"&&((N=(A=b.type)==null?void 0:A.contains)==null?void 0:N.type)!=="string"&&((M=(W=b.type)==null?void 0:W.contains)==null?void 0:M.type)!=="number"&&((L=(_=b.type)==null?void 0:_.contains)==null?void 0:L.type)!=="boolean"&&((Q=(Z=b.type)==null?void 0:Z.contains)==null?void 0:Q.type)!=="date"}]),title:b.name,onClick:I(Y=>{var de,H,U,X,F,K,P,pe,me;return((de=b.type)==null?void 0:de.type)==="array"&&((U=(H=b.type)==null?void 0:H.contains)==null?void 0:U.type)!=="string"&&((F=(X=b.type)==null?void 0:X.contains)==null?void 0:F.type)!=="number"&&((P=(K=b.type)==null?void 0:K.contains)==null?void 0:P.type)!=="boolean"&&((me=(pe=b.type)==null?void 0:pe.contains)==null?void 0:me.type)!=="date"?e.toggleVeryDeepNestedExpansion(s.field,n.name,d.name,b.name):null},["stop"])},S(b.name),11,js),y("div",{class:"resize-handle",onMousedown:I(Y=>e.startVeryDeepNestedColumnResize(Y,s.field,n.name,d.name,b),["stop","prevent"]),title:"Drag to resize"},null,40,zs)])],4)}),128))])):D("",!0)],4))),128))])):D("",!0)],4))),128))])):D("",!0)],4))),128))])):D("",!0),e.headers.some(s=>e.isColumnExpanded(s.field)&&e.getNestedProperties(s.field).some(n=>e.isNestedObjectExpanded(s.field,n.name)&&e.getNestedObjectProperties(s.field,n.name).some(l=>e.getDeepNestedProperties(s.field,n.name,l.name).some(d=>e.isVeryDeepNestedExpanded(s.field,n.name,l.name,d.name)))))?(a(),u("tr",Ws,[(a(!0),u(j,null,O(e.headers,s=>(a(),u("th",{key:"very-deep-"+s.field,style:V([{width:(e.isColumnExpanded(s.field)?e.getExpandedColumnWidth(s.field):s.width)+"px",maxWidth:(e.isColumnExpanded(s.field)?e.getExpandedColumnWidth(s.field):s.width)+"px",boxSizing:"border-box",flexShrink:"0"},{border:"1px solid white"}]),class:"px-0 py-0 text-left text-xs font-medium"},[e.isColumnExpanded(s.field)?(a(),u("div",Ms,[(a(!0),u(j,null,O(e.getNestedProperties(s.field),(n,l)=>(a(),u("div",{key:`${s.field}.${n.name}`,class:"border-r last:border-r-0 border-white",style:V({width:e.getNestedPropRenderWidth(s.field,n,l)+"px",minWidth:"80px",boxSizing:"border-box",flexShrink:"0"})},[e.isNestedObjectExpanded(s.field,n.name)?(a(),u("div",Os,[(a(!0),u(j,null,O(e.getNestedObjectProperties(s.field,n.name),d=>(a(),u("div",{key:`${s.field}.${n.name}.${d.name}`,class:"border-r last:border-r-0 border-white",style:V({width:(e.isDeepNestedExpanded(s.field,n.name,d.name)?e.getDeepNestedProperties(s.field,n.name,d.name).reduce((c,f)=>{var w;if(((w=f.type)==null?void 0:w.type)==="array"&&e.isVeryDeepNestedExpanded(s.field,n.name,d.name,f.name)){const C=e.getVeryDeepNestedProperties(s.field,n.name,d.name,f.name);return c+C.reduce((x,T)=>x+e.getUltraDeepNestedSubColumnWidth(s.field,n.name,d.name,f.name,T.name),0)}return c+e.getDeepNestedSubColumnWidth(s.field,n.name,d.name,f.name)},0):e.getNestedObjectSubColumnWidth(s.field,n.name,d.name))+"px",minWidth:"100px",flexShrink:"0"})},[e.isDeepNestedExpanded(s.field,n.name,d.name)?(a(),u("div",Ts,[(a(!0),u(j,null,O(e.getDeepNestedProperties(s.field,n.name,d.name),b=>{var c,f;return a(),u(j,{key:`${s.field}.${n.name}.${d.name}.${b.name}`},[((c=b.type)==null?void 0:c.type)==="array"&&e.isVeryDeepNestedExpanded(s.field,n.name,d.name,b.name)?(a(!0),u(j,{key:0},O(e.getVeryDeepNestedProperties(s.field,n.name,d.name,b.name),w=>(a(),u("div",{key:`${s.field}.${n.name}.${d.name}.${b.name}.${w.name}`,class:"border-r last:border-r-0 border-white flex items-center px-2 py-1 relative overflow-hidden min-w-0",style:V({width:e.getUltraDeepNestedSubColumnWidth(s.field,n.name,d.name,b.name,w.name)+"px",minWidth:"100px",boxSizing:"border-box",flexShrink:"0",height:"29px"})},[y("span",{class:"truncate text-xs text-gray-800 flex-1",title:w.name},S(w.name),9,Vs),y("div",{class:"resize-handle",onMousedown:I(C=>e.startUltraDeepNestedColumnResize(C,s.field,n.name,d.name,b.name,w),["stop","prevent"]),title:"Drag to resize"},null,40,Rs)],4))),128)):D("",!0),((f=b.type)==null?void 0:f.type)==="array"&&e.isVeryDeepNestedExpanded(s.field,n.name,d.name,b.name)?D("",!0):(a(),u("div",{key:1,class:"border-r last:border-r-0 border-gray-300 px-2 py-1",style:V({width:e.getDeepNestedSubColumnWidth(s.field,n.name,d.name,b.name)+"px",minWidth:"100px",minHeight:"24px",flexShrink:"0",boxSizing:"border-box"})},"Â ",4))],64)}),128))])):D("",!0)],4))),128))])):D("",!0)],4))),128))])):D("",!0)],4))),128))])):D("",!0)]),y("tbody",null,[(a(!0),u(j,null,O(e.items,s=>(a(),u("tr",{key:s.id,class:"hover:bg-gray-50"},[(a(!0),u(j,null,O(e.headers,n=>(a(),u("td",{key:n.field,style:V({width:(e.isColumnExpanded(n.field)?e.getExpandedColumnWidth(n.field):n.width)+"px",maxWidth:(e.isColumnExpanded(n.field)?e.getExpandedColumnWidth(n.field):n.width)+"px",boxSizing:"border-box",flexShrink:"0"}),class:"border border-gray-300 px-0 py-0 text-sm"},[y("div",_s,[y("div",Ls,[e.isColumnExpanded(n.field)?(a(),u(j,{key:0},[e.isPrimitiveArray(n.field)&&Array.isArray(s[n.field])?(a(),u(j,{key:0},[e.isRowCellExpanded(s.id,n.field)?(a(),u("div",Fs,[y("div",Bs,[(a(!0),u(j,null,O(s[n.field],(l,d)=>(a(),u("div",{key:d,class:"py-1 text-xs cursor-pointer hover:bg-gray-100 border-b last:border-b-0 border-gray-200",title:String(l),onClick:b=>e.toggleRowExpansion(s.id,n.field)},[y("div",Is,[y("span",Hs,S(l),1),d===0?(a(),u("span",Ks,"^")):D("",!0)])],8,Us))),128))])])):(a(),u("div",Xs,[y("div",{class:"cursor-pointer hover:bg-gray-100 rounded px-1 flex items-center justify-between",title:String(s[n.field][0]),onClick:l=>s[n.field].length>1?e.toggleRowExpansion(s.id,n.field):null},[y("span",Js,S(s[n.field][0]),1),s[n.field].length>1?(a(),u("span",Gs," +"+S(s[n.field].length-1),1)):D("",!0)],8,qs)]))],64)):Array.isArray(s[n.field])?(a(),u(j,{key:1},[e.isRowCellExpanded(s.id,n.field)?(a(),u("div",Zs,[(a(!0),u(j,null,O(e.getNestedProperties(n.field),(l,d)=>(a(),u("div",{key:`${n.field}.${l.name}`,class:"border-r last:border-r-0 border-gray-300 text-xs",style:V({width:e.getNestedPropRenderWidth(n.field,l,d)+"px",minWidth:"80px",boxSizing:"border-box",flexShrink:"0"})},[y("div",Qs,[(a(!0),u(j,null,O(s[n.field],(b,c)=>(a(),u("div",{key:c,class:"px-3 py-2 cursor-pointer hover:bg-gray-100 border-b last:border-b-0 border-gray-200 flex items-center justify-between",title:String(b[l.name]||""),onClick:f=>e.toggleRowExpansion(s.id,n.field)},[y("span",Ps,S(b[l.name]??"-"),1),c===0&&l.name===e.getArrayPrimaryNestedProp(n.field)?(a(),u("span",en,"^")):D("",!0)],8,Ys))),128))])],4))),128))])):(a(),u("div",tn,[(a(!0),u(j,null,O(e.getNestedProperties(n.field),(l,d)=>{var b,c;return a(),u("div",{key:`${n.field}.${l.name}`,class:"px-3 py-2 border-r last:border-r-0 border-gray-300",style:V({width:e.getNestedPropRenderWidth(n.field,l,d)+"px",minWidth:"80px",boxSizing:"border-box",flexShrink:"0"})},[y("div",{class:J(["flex items-center justify-between w-full",{"cursor-pointer hover:bg-gray-100 rounded":l.name===e.getArrayPrimaryNestedProp(n.field)&&s[n.field].length>1}]),title:String(((b=s[n.field][0])==null?void 0:b[l.name])||""),onClick:f=>l.name===e.getArrayPrimaryNestedProp(n.field)&&s[n.field].length>1?e.toggleRowExpansion(s.id,n.field):null},[y("span",nn,S(((c=s[n.field][0])==null?void 0:c[l.name])??"-"),1),l.name===e.getArrayPrimaryNestedProp(n.field)&&s[n.field].length>1?(a(),u("span",on," +"+S(s[n.field].length-1),1)):D("",!0)],10,sn)],4)}),128))]))],64)):typeof s[n.field]=="object"&&s[n.field]!==null?(a(),u("div",rn,[(a(!0),u(j,null,O(e.getNestedProperties(n.field),l=>{var d,b;return a(),u("div",{key:`${n.field}.${l.name}`,class:"border-r last:border-r-0 border-gray-300 text-xs",style:V({width:e.getNestedPropWidth(n.field,l)+"px",minWidth:"80px",flexShrink:"0",boxSizing:"border-box"})},[l.isArray&&e.isNestedObjectExpanded(n.field,l.name)&&Array.isArray((d=s[n.field])==null?void 0:d[l.name])?(a(),u("div",ln,[(a(!0),u(j,null,O(e.getNestedObjectProperties(n.field,l.name),c=>{var f,w,C,x,T;return a(),u("div",{key:`${n.field}.${l.name}.${c.name}`,class:"border-r last:border-r-0 border-gray-300",style:V({width:(()=>{var v;return((v=c.type)==null?void 0:v.type)==="array"&&e.isDeepNestedExpanded(n.field,l.name,c.name)?e.getDeepNestedProperties(n.field,l.name,c.name).reduce((E,k)=>{var A;if(((A=k.type)==null?void 0:A.type)==="array"&&e.isVeryDeepNestedExpanded(n.field,l.name,c.name,k.name)){const N=e.getVeryDeepNestedProperties(n.field,l.name,c.name,k.name);return E+N.reduce((W,M)=>W+e.getUltraDeepNestedSubColumnWidth(n.field,l.name,c.name,k.name,M.name),0)}return E+e.getDeepNestedSubColumnWidth(n.field,l.name,c.name,k.name)},0):e.getNestedObjectSubColumnWidth(n.field,l.name,c.name)})()+"px",minWidth:"100px",flexShrink:"0"})},[c.isUnionArray&&e.isDeepNestedExpanded(n.field,l.name,c.name)?(a(),u("div",an,[(a(!0),u(j,null,O(e.getDeepNestedProperties(n.field,l.name,c.name),v=>{var z,E;return a(),u(j,{key:`${n.field}.${l.name}.${c.name}.${v.name}`},[((z=v.type)==null?void 0:z.type)==="array"&&e.isVeryDeepNestedExpanded(n.field,l.name,c.name,v.name)?(a(!0),u(j,{key:0},O(e.getVeryDeepNestedProperties(n.field,l.name,c.name,v.name),k=>(a(),u("div",{key:`${n.field}.${l.name}.${c.name}.${v.name}.${k.name}`,class:"border-r last:border-r-0 border-gray-300 cursor-pointer hover:bg-sky-50",style:V({width:e.getUltraDeepNestedSubColumnWidth(n.field,l.name,c.name,v.name,k.name)+"px",minWidth:"100px",boxSizing:"border-box",flexShrink:"0",display:"flex",alignItems:"start"}),onClick:I(A=>(()=>{var W,M;const N=(W=s[n.field])==null?void 0:W[l.name];if(Array.isArray(N)&&N.length>0){const _=(M=N[0])==null?void 0:M[c.name];Array.isArray(_)&&_.length>0&&e.toggleNestedArrayExpansion(s.id,`${n.field}.${l.name}.${c.name}.0`,v.name)}})(),["stop"])},[y("div",un,[(a(!0),u(j,null,O((()=>{var M,_;const A=(M=s[n.field])==null?void 0:M[l.name];if(!Array.isArray(A)||A.length===0)return[];const N=(_=A[0])==null?void 0:_[c.name];return!Array.isArray(N)||N.length===0?[]:e.isNestedArrayExpanded(s.id,`${n.field}.${l.name}`,c.name)?N:[N[0]]})(),(A,N)=>(a(),u("div",{key:N,class:"border-b last:border-b-0 border-gray-200"},[(a(!0),u(j,null,O((()=>{const W=A==null?void 0:A[v.name];return!Array.isArray(W)||W.length===0?[]:e.isNestedArrayExpanded(s.id,`${n.field}.${l.name}.${c.name}.${N}`,v.name)?W:[W[0]]})(),(W,M)=>{var _,L;return a(),u("div",{key:M,class:"py-2 border-b last:border-b-0 border-gray-300 flex items-center justify-between px-3",title:String((W==null?void 0:W[k.name])??"")},[y("span",pn,S((W==null?void 0:W[k.name])??"-"),1),M===0&&k.name===e.getVeryDeepNestedProperties(n.field,l.name,c.name,v.name)[0].name&&e.isNestedArrayExpanded(s.id,`${n.field}.${l.name}.${c.name}.${N}`,v.name)?(a(),u("span",mn,"^")):D("",!0),M===0&&k.name===e.getVeryDeepNestedProperties(n.field,l.name,c.name,v.name)[0].name&&!e.isNestedArrayExpanded(s.id,`${n.field}.${l.name}.${c.name}.${N}`,v.name)&&(((_=A==null?void 0:A[v.name])==null?void 0:_.length)??0)>1?(a(),u("span",hn,"+"+S((((L=A==null?void 0:A[v.name])==null?void 0:L.length)??1)-1),1)):D("",!0)],8,cn)}),128))]))),128))])],12,dn))),128)):D("",!0),((E=v.type)==null?void 0:E.type)==="array"&&e.isVeryDeepNestedExpanded(n.field,l.name,c.name,v.name)?D("",!0):(a(),u("div",{key:1,class:"border-r last:border-r-0 border-gray-300",style:V({width:e.getDeepNestedSubColumnWidth(n.field,l.name,c.name,v.name)+"px",minWidth:"100px",minHeight:"24px",flexShrink:"0",overflow:"hidden",boxSizing:"border-box"})},[y("div",fn,[(a(!0),u(j,null,O((()=>{var W,M;const k=(W=s[n.field])==null?void 0:W[l.name];if(!Array.isArray(k)||k.length===0)return[];const A=(M=k[0])==null?void 0:M[c.name];return!Array.isArray(A)||A.length===0?[]:e.isNestedArrayExpanded(s.id,`${n.field}.${l.name}`,c.name)?A:[A[0]]})(),(k,A)=>(a(),u("div",{key:A,class:"border-b last:border-b-0 border-gray-200"},[Array.isArray(k==null?void 0:k[v.name])?(a(),u("div",{key:0,class:"cursor-pointer hover:bg-gray-100 rounded",onClick:I(N=>e.toggleNestedArrayExpansion(s.id,`${n.field}.${l.name}.${c.name}.${A}`,v.name),["stop"])},[e.isNestedArrayExpanded(s.id,`${n.field}.${l.name}.${c.name}.${A}`,v.name)?(a(),u("div",gn,[(a(!0),u(j,null,O(k[v.name],(N,W)=>(a(),u("div",{key:W,class:"px-3 py-2 border-b last:border-b-0 border-gray-300 flex items-center justify-between",title:String(typeof N=="object"&&N!==null?Object.values(N)[0]??"-":N)},[y("span",vn,S(typeof N=="object"&&N!==null?Object.values(N)[0]??"-":N),1),W===0?(a(),u("span",wn,"^")):D("",!0)],8,bn))),128))])):(a(),u("div",{key:1,class:"px-3 py-2 flex items-center justify-between",title:String((()=>{const N=k[v.name][0];return typeof N=="object"&&N!==null?Object.values(N)[0]??"-":N})())},[y("span",Cn,S((()=>{const N=k[v.name][0];return typeof N=="object"&&N!==null?Object.values(N)[0]??"-":N})()),1),k[v.name].length>1?(a(),u("span",$n," +"+S(k[v.name].length-1),1)):D("",!0),A===0&&v.name===e.getDeepNestedProperties(n.field,l.name,c.name)[0].name?(a(),u("span",kn,S((()=>{var _,L;const N=(_=s[n.field])==null?void 0:_[l.name];if(!Array.isArray(N)||N.length===0)return"";const W=(L=N[0])==null?void 0:L[c.name];return!Array.isArray(W)||W.length<=1?"":e.isNestedArrayExpanded(s.id,`${n.field}.${l.name}`,c.name)?"^":`+${W.length-1}`})()),1)):D("",!0)],8,xn))],8,yn)):(a(),u("div",{key:1,class:"px-3 py-2 cursor-pointer hover:bg-gray-100 rounded flex items-center justify-between",title:String((k==null?void 0:k[v.name])??""),onClick:I(N=>e.toggleNestedArrayExpansion(s.id,`${n.field}.${l.name}`,c.name),["stop"])},[y("span",Sn,S((k==null?void 0:k[v.name])??"-"),1),A===0&&v.name===e.getDeepNestedProperties(n.field,l.name,c.name)[0].name?(a(),u("span",An,S((()=>{var _,L;const N=(_=s[n.field])==null?void 0:_[l.name];if(!Array.isArray(N)||N.length===0)return"";const W=(L=N[0])==null?void 0:L[c.name];return!Array.isArray(W)||W.length<=1?"":e.isNestedArrayExpanded(s.id,`${n.field}.${l.name}`,c.name)?"^":`+${W.length-1}`})()),1)):D("",!0)],8,Nn))]))),128))])],4))],64)}),128))])):c.isUnionArray&&e.isNestedArrayExpanded(s.id,`${n.field}.${l.name}`,c.name)?(a(),u("div",En,[(a(!0),u(j,null,O((()=>{var E,k;const v=(E=s[n.field])==null?void 0:E[l.name];if(!Array.isArray(v)||v.length===0)return[];const z=(k=v[0])==null?void 0:k[c.name];return Array.isArray(z)?z:[]})(),(v,z)=>(a(),u("div",{key:z,class:"px-3 py-2 text-xs cursor-pointer hover:bg-gray-100 border-b last:border-b-0 border-gray-200 flex items-center justify-between",onClick:E=>e.toggleNestedArrayExpansion(s.id,`${n.field}.${l.name}`,c.name)},[y("span",{class:"truncate",title:String((v==null?void 0:v.type)||v||"")},S((v==null?void 0:v.type)||v||"-"),9,jn),z===0?(a(),u("span",zn,"^")):D("",!0)],8,Dn))),128))])):((f=c.type)==null?void 0:f.type)==="array"&&!c.isUnionArray&&e.isDeepNestedExpanded(n.field,l.name,c.name)?(a(),u("div",Wn,[(a(!0),u(j,null,O(e.getDeepNestedProperties(n.field,l.name,c.name),v=>(a(),u("div",{key:`${n.field}.${l.name}.${c.name}.${v.name}`,class:"px-2 py-2 border-r last:border-r-0 border-gray-300",style:V({width:e.getDeepNestedSubColumnWidth(n.field,l.name,c.name,v.name)+"px",minWidth:"100px"})},[y("div",{class:"truncate",title:String((()=>{var N;const z=(N=s[n.field])==null?void 0:N[l.name];if(!z||z.length===0)return"-";const E=z[0],k=E==null?void 0:E[c.name];if(!Array.isArray(k)||k.length===0)return"-";const A=k[0];return(A==null?void 0:A[v.name])??"-"})())},S((()=>{var N;const z=(N=s[n.field])==null?void 0:N[l.name];if(!z||z.length===0)return"-";const E=z[0],k=E==null?void 0:E[c.name];if(!Array.isArray(k)||k.length===0)return"-";const A=k[0];return(A==null?void 0:A[v.name])??"-"})()),9,Mn)],4))),128))])):(a(),u("div",{key:3,class:J(["px-2 py-2 truncate",{"cursor-pointer hover:bg-gray-100 rounded":((w=c.type)==null?void 0:w.type)==="array"}]),title:String(((T=(x=(C=s[n.field])==null?void 0:C[l.name])==null?void 0:x[0])==null?void 0:T[c.name])??""),onClick:v=>{var z;return((z=c.type)==null?void 0:z.type)==="array"?e.toggleNestedArrayExpansion(s.id,`${n.field}.${l.name}`,c.name):null}},S((()=>{var k;const v=(k=s[n.field])==null?void 0:k[l.name];if(!v||v.length===0)return"-";const z=v[0],E=z==null?void 0:z[c.name];if(Array.isArray(E)){if(E.length===0)return"[]";const A=E[0];if(typeof A!="object")return E.length>1?`${A} +${E.length-1}`:String(A);const N=(A==null?void 0:A.type)||Object.values(A)[0]||"Item";return E.length>1?`${N} +${E.length-1}`:String(N)}return E??"-"})()),11,On))],4)}),128))])):l.isObject&&e.isNestedObjectExpanded(n.field,l.name)?(a(),u("div",Tn,[(a(!0),u(j,null,O(e.getNestedObjectProperties(n.field,l.name),c=>{var f,w,C,x;return a(),u("div",{key:`${n.field}.${l.name}.${c.name}`,class:"px-2 py-2 border-r last:border-r-0 border-gray-300",style:V({width:e.getNestedObjectSubColumnWidth(n.field,l.name,c.name)+"px",minWidth:"100px"})},[y("div",{class:"truncate",title:String(((w=(f=s[n.field])==null?void 0:f[l.name])==null?void 0:w[c.name])??"")},S(((x=(C=s[n.field])==null?void 0:C[l.name])==null?void 0:x[c.name])??"-"),9,Vn)],4)}),128))])):(a(),u("div",{key:2,class:"px-2 py-2 truncate",title:String(((b=s[n.field])==null?void 0:b[l.name])??"")},S((()=>{var f;const c=(f=s[n.field])==null?void 0:f[l.name];if(c==null)return"-";if(Array.isArray(c)){if(c.length===0)return"[]";const w=c[0];if(typeof w!="object")return c.length>1?`${w} +${c.length-1}`:String(w);const C=Object.keys(w);if(C.length>0){const x=w[C[0]];return c.length>1?`${x} +${c.length-1}`:String(x)}return c.length>1?`Item +${c.length-1}`:"Item"}if(l.isObject&&c){const w=Object.keys(c);return w.length>0?c[w[0]]??"{...}":"{...}"}return c})()),9,Rn))],4)}),128))])):D("",!0)],64)):(a(),u(j,{key:1},[e.isRowCellExpanded(s.id,n.field)&&n.isCollapsable?(a(),u("div",_n,[y("div",Ln,[Array.isArray(s[n.field])?(a(!0),u(j,{key:0},O(s[n.field],(l,d)=>(a(),u("div",{key:d,class:"p-2! text-xs cursor-pointer hover:bg-gray-100 border-b last:border-b-0 border-gray-200",onClick:b=>e.toggleRowExpansion(s.id,n.field)},[y("div",Bn,[typeof l!="object"?(a(),u("span",{key:0,class:"truncate",title:String(l)},S(l),9,Un)):(a(),u("span",{key:1,class:"truncate",title:e.getArrayObjectLabel(l,n.field)},S(e.getArrayObjectLabel(l,n.field)),9,In)),d===0?(a(),u("span",Hn,"^")):D("",!0)])],8,Fn))),128)):typeof s[n.field]=="object"?(a(),u("div",{key:1,class:"text-xs truncate px-2 py-1",title:JSON.stringify(s[n.field])},S(JSON.stringify(s[n.field])),9,Kn)):D("",!0)])])):(a(),u("div",Xn,[y("div",{class:J([{"cursor-pointer hover:bg-gray-100 rounded px-1":n.isCollapsable},"truncate"]),title:e.getCellTitleValue(s,n.field),onClick:l=>n.isCollapsable?e.toggleRowExpansion(s.id,n.field):null},S(e.isDateField(n.field)?e.formatDate(s[n.field]):e.getCellDisplayValue(s,n.field)),11,qn)]))],64))])])],4))),128))]))),128))])]),e.items.length===0&&!e.loading?(a(),u("div",Jn,[R(h,{label:"No Data - Click To Search Again",onClick:e.find},null,8,["onClick"])])):D("",!0),e.loading?(a(),u("div",Gn,m[12]||(m[12]=[y("div",{class:"text-lg font-semibold"},"Loading...",-1)]))):D("",!0)]),y("div",Zn,[y("div",Qn," Showing "+S(e.options.first+1)+" to "+S(Math.min(e.options.first+e.options.rows,e.totalItems))+" of "+S(e.totalItems)+" results ",1),y("div",Yn,[R(h,{label:"Previous",size:"small",disabled:e.options.first===0,onClick:m[2]||(m[2]=s=>e.onPage({first:Math.max(0,e.options.first-e.options.rows),rows:e.options.rows}))},null,8,["disabled"]),R(h,{label:"Next",size:"small",disabled:e.options.first+e.options.rows>=e.totalItems,onClick:m[3]||(m[3]=s=>e.onPage({first:e.options.first+e.options.rows,rows:e.options.rows}))},null,8,["disabled"])])])])}const ei=ve(Jt,[["render",Pn],["__scopeId","data-v-0c67971d"]]);var ti=Object.defineProperty,si=Object.getOwnPropertyDescriptor,ae=(e,m,t,i)=>{for(var o=i>1?void 0:i?si(m,t):m,r=e.length-1,p;r>=0;r--)(p=e[r])&&(o=(i?p(m,t,o):p(o))||o);return i&&o&&ti(m,t,o),o};let te=class extends ge{constructor(){super(...arguments);$(this,"modelValue");$(this,"title");$(this,"entityProps");$(this,"showNewVersion",!0);$(this,"onKeydown",m=>{m.key==="Escape"&&this.visible&&this.onHide()})}get visible(){return this.modelValue}set visible(m){this.updateModelValue(m)}updateModelValue(m){return m}emitOpen(){return!0}emitClose(){return!0}mounted(){this.visible&&this.emitOpen(),window.addEventListener("keydown",this.onKeydown)}beforeUnmount(){window.removeEventListener("keydown",this.onKeydown)}onHide(){this.visible=!1,this.emitClose()}toggleVersion(){this.showNewVersion=!this.showNewVersion}};ae([se({default:!1})],te.prototype,"modelValue",2);ae([se({default:"Data View"})],te.prototype,"title",2);ae([se({default:()=>({})})],te.prototype,"entityProps",2);ae([Se("update:modelValue")],te.prototype,"updateModelValue",1);ae([Se("open")],te.prototype,"emitOpen",1);ae([Se("close")],te.prototype,"emitClose",1);te=ae([be({components:{EntityList:ei,EntityListOld:Qe}})],te);const ni={class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},ii={class:"relative w-full h-screen bg-white shadow-lg overflow-hidden overflow-y-scroll"},oi={class:"flex items-center justify-between p-4 border-b border-gray-200"},ri={class:"text-xl font-semibold text-gray-900"},li={class:"flex items-center gap-2"},ai={class:"h-full"};function di(e,m,t,i,o,r){const p=Qe,h=re("EntityList");return He((a(),u("div",ni,[y("div",ii,[y("div",oi,[y("h3",ri,S(e.title),1),y("div",li,[y("button",{onClick:m[0]||(m[0]=(...g)=>e.toggleVersion&&e.toggleVersion(...g)),class:"px-3 py-1.5 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors"},S(e.showNewVersion?"Old Version":"New Version"),1),y("button",{onClick:m[1]||(m[1]=(...g)=>e.onHide&&e.onHide(...g)),class:"text-gray-400 hover:text-gray-900 hover:bg-gray-200 rounded-lg text-sm w-8 h-8 flex items-center justify-center"},m[2]||(m[2]=[y("svg",{class:"w-3 h-3",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 14 14"},[y("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"})],-1)]))])]),y("div",ai,[e.showNewVersion?(a(),ee(h,_e(ue({key:1},e.entityProps)),null,16)):(a(),ee(p,_e(ue({key:0},e.entityProps)),null,16))])])],512)),[[Ke,e.visible]])}const Pe=ve(te,[["render",di]]);var ui=ot`
    .p-tag {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background: dt('tag.primary.background');
        color: dt('tag.primary.color');
        font-size: dt('tag.font.size');
        font-weight: dt('tag.font.weight');
        padding: dt('tag.padding');
        border-radius: dt('tag.border.radius');
        gap: dt('tag.gap');
    }

    .p-tag-icon {
        font-size: dt('tag.icon.size');
        width: dt('tag.icon.size');
        height: dt('tag.icon.size');
    }

    .p-tag-rounded {
        border-radius: dt('tag.rounded.border.radius');
    }

    .p-tag-success {
        background: dt('tag.success.background');
        color: dt('tag.success.color');
    }

    .p-tag-info {
        background: dt('tag.info.background');
        color: dt('tag.info.color');
    }

    .p-tag-warn {
        background: dt('tag.warn.background');
        color: dt('tag.warn.color');
    }

    .p-tag-danger {
        background: dt('tag.danger.background');
        color: dt('tag.danger.color');
    }

    .p-tag-secondary {
        background: dt('tag.secondary.background');
        color: dt('tag.secondary.color');
    }

    .p-tag-contrast {
        background: dt('tag.contrast.background');
        color: dt('tag.contrast.color');
    }
`,ci={root:function(m){var t=m.props;return["p-tag p-component",{"p-tag-info":t.severity==="info","p-tag-success":t.severity==="success","p-tag-warn":t.severity==="warn","p-tag-danger":t.severity==="danger","p-tag-secondary":t.severity==="secondary","p-tag-contrast":t.severity==="contrast","p-tag-rounded":t.rounded}]},icon:"p-tag-icon",label:"p-tag-label"},pi=rt.extend({name:"tag",style:ui,classes:ci}),mi={name:"BaseTag",extends:lt,props:{value:null,severity:null,rounded:Boolean,icon:String},style:pi,provide:function(){return{$pcTag:this,$parentInstance:this}}};function ye(e){"@babel/helpers - typeof";return ye=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},ye(e)}function hi(e,m,t){return(m=fi(m))in e?Object.defineProperty(e,m,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[m]=t,e}function fi(e){var m=yi(e,"string");return ye(m)=="symbol"?m:m+""}function yi(e,m){if(ye(e)!="object"||!e)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var i=t.call(e,m);if(ye(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(m==="string"?String:Number)(e)}var et={name:"Tag",extends:mi,inheritAttrs:!1,computed:{dataP:function(){return at(hi({rounded:this.rounded},this.severity,this.severity))}}},gi=["data-p"];function bi(e,m,t,i,o,r){return a(),u("span",ue({class:e.cx("root"),"data-p":r.dataP},e.ptmi("root")),[e.$slots.icon?(a(),ee(ut(e.$slots.icon),ue({key:0,class:e.cx("icon")},e.ptm("icon")),null,16,["class"])):e.icon?(a(),u("span",ue({key:1,class:[e.cx("icon"),e.icon]},e.ptm("icon")),null,16)):D("",!0),e.value!=null||e.$slots.default?dt(e.$slots,"default",{key:2},function(){return[y("span",ue({class:e.cx("label")},e.ptm("label")),S(e.value),17)]}):D("",!0)],16,gi)}et.render=bi;var vi=Object.defineProperty,wi=Object.getOwnPropertyDescriptor,ne=(e,m,t,i)=>{for(var o=i>1?void 0:i?wi(m,t):m,r=e.length-1,p;r>=0;r--)(p=e[r])&&(o=(i?p(m,t,o):p(o))||o);return i&&o&&vi(m,t,o),o};const q=Te("project-structures-table");let G=class extends ge{constructor(){super(...arguments);$(this,"applicationId");$(this,"showNewStructureButton");$(this,"newStructureButtonText");$(this,"crudTable");$(this,"structureTableHeaders",[{field:"name",header:"Structure Name",sortable:!0},{field:"description",header:"Description",sortable:!1},{field:"created",header:"Created",sortable:!1},{field:"updated",header:"Updated",sortable:!1},{field:"published",header:"Status",sortable:!1,centered:!0}]);$(this,"searchText","");$(this,"showModal",!1);$(this,"showItemModal",!1);$(this,"showPublishModal",!1);$(this,"showUnpublishModal",!1);$(this,"selectedStructure",null);$(this,"isInitialized",!1);$(this,"DatetimeUtil",Ve);$(this,"actionMenus",[]);$(this,"currentActionItem",null);$(this,"dataSource1",ie.getStructureService())}get projectId(){return this.$route.params.projectId}mounted(){this.searchText=this.$route.query["search-structure"]||"",this.isInitialized=!0,this.refreshTable(),this.markProjectAsActive()}onSearchParamChanged(t){this.isInitialized&&(this.searchText=t||"",this.refreshTable())}onProjectIdChange(){this.refreshTable(),this.markProjectAsActive()}onApplicationIdChange(t,i){q("applicationId changed from %s to %s",i,t),this.refreshTable(),this.markProjectAsActive()}async onGlobalApplicationChange(t,i){q("APPLICATION_STATE.currentApplication changed from %s to %s",i==null?void 0:i.id,t==null?void 0:t.id),this.isProjectStructuresPage&&t&&t.id!==(i==null?void 0:i.id)?await this.handleApplicationChangeForProjectStructures(t):(this.refreshTable(),this.markProjectAsActive())}get isProjectStructuresPage(){return/^\/application\/[^/]+\/project\/[^/]+\/structures$/.test(this.$route.path)}async handleApplicationChangeForProjectStructures(t){var i;try{q("Handling application change for ProjectStructures page");const o={pageNumber:0,pageSize:1},p=(i=(await ie.getProjectService().findAllForApplication(t.id,o)).content)==null?void 0:i[0];if(p){q("Found first project: %s, navigating to it",p.name);const h=t.id,g=p.id??"";await this.$router.push(`/application/${encodeURIComponent(h)}/project/${encodeURIComponent(g)}/structures`)}else q("No projects found for application: %s",t.id),this.refreshTable(),this.markProjectAsActive()}catch(o){q("Error handling application change: %O",o),this.refreshTable(),this.markProjectAsActive()}}get dataSource(){return{findAll:async t=>{var o;q("dataSource.findAll called with projectId: %s, currentApplication: %s",this.projectId,(o=ze.currentApplication)==null?void 0:o.id);const i=await ie.getStructureService().findAllForProject(this.projectId,t);return ze.structuresCount=i.totalElements??0,i},search:async(t,i)=>{var r;q("dataSource.search called with projectId: %s, currentApplication: %s",this.projectId,(r=ze.currentApplication)==null?void 0:r.id);const o=`projectId:${this.projectId} && ${this.searchText}`;return ie.getStructureService().search(o,i)}}}refreshTable(){var t,i;(i=(t=this.crudTable)==null?void 0:t.find)==null||i.call(t)}updateRouteQuery(t){this.searchText=t;const i={...this.$route.query};t?i["search-structure"]=t:delete i["search-structure"],this.$router.replace({query:i}).catch(()=>{}),this.refreshTable()}openModal(t){try{this.selectedStructure=t,this.showModal=!0}catch(i){q("Failed to open modal with structure: %O",i)}}closeModal(){this.showModal=!1,this.selectedStructure=null}openItemModal(t){this.selectedStructure=t,this.showItemModal=!0}closeItemModal(){this.showItemModal=!1,this.selectedStructure=null}openPublishModal(t){q("openPublishModal called for item: %s",t.name),this.selectedStructure=t,this.showPublishModal=!0}closePublishModal(){this.showPublishModal=!1,this.selectedStructure=null}openUnpublishModal(t){this.selectedStructure=t,this.showUnpublishModal=!0}closeUnpublishModal(){this.showUnpublishModal=!1,this.selectedStructure=null}onAddItem(){}onEditItem(t){this.$router.push(`${this.$route.path}/edit/${t.id}`)}handleRowClick(t){t.published?(q("Opening data modal for published structure"),this.openModal(t)):(q("Opening publish modal for unpublished structure"),this.openPublishModal(t))}toggleMenu(t,i,o){this.currentActionItem=i;const r=this.actionMenus[o];r&&r.toggle(t)}async publish(t){var o;t.publishing=!0;let i=(o=this.$refs)==null?void 0:o.crudTable;try{await this.dataSource1.publish(t.id),i==null||i.find(),delete t.publishing}catch(r){delete t.publishing,i==null||i.displayAlert(r.message)}}async unPublish(t){this.openUnpublishModal(t)}async unpublishFromModal(){if(!this.selectedStructure)return;const t=this.selectedStructure;t.publishing=!0;try{await this.dataSource1.unPublish(t.id),this.closeUnpublishModal(),this.refreshTable(),delete t.publishing}catch(i){delete t.publishing,q("Error unpublishing structure: %O",i)}}getActionMenu(t){return[{label:t.published?"Unpublish":"Publish",icon:t.published?"pi pi-eye-slash":"pi pi-eye",command:()=>t.published?this.unPublish(t):this.publish(t)},{label:"View",icon:"pi pi-file",command:i=>{var o,r,p,h;(r=(o=i==null?void 0:i.originalEvent)==null?void 0:o.stopPropagation)==null||r.call(o),(h=(p=i==null?void 0:i.originalEvent)==null?void 0:p.preventDefault)==null||h.call(p),this.openItemModal(t)}}]}async publishFromModal(){if(!this.selectedStructure)return;const t=this.selectedStructure;t.publishing=!0;try{await this.dataSource1.publish(t.id),this.closePublishModal(),this.refreshTable(),delete t.publishing}catch(i){delete t.publishing,q("Error publishing structure: %O",i)}}get isPublishing(){var t;return((t=this.selectedStructure)==null?void 0:t.publishing)||!1}async markProjectAsActive(){var t,i;try{const o=(i=(t=this.$root)==null?void 0:t.$refs)==null?void 0:i.header;o!=null&&o.setActiveProjectById&&await o.setActiveProjectById(this.applicationId,this.projectId)}catch(o){q("Failed to mark active project: %O",o)}}};ne([se({required:!0})],G.prototype,"applicationId",2);ne([se({required:!1,default:!1})],G.prototype,"showNewStructureButton",2);ne([se({required:!1,default:"New Structure"})],G.prototype,"newStructureButtonText",2);ne([nt("crudTable")],G.prototype,"crudTable",2);ne([Ae("$route.query.search-structure")],G.prototype,"onSearchParamChanged",1);ne([Ae("$route.params.projectId",{immediate:!0})],G.prototype,"onProjectIdChange",1);ne([Ae("applicationId",{immediate:!0})],G.prototype,"onApplicationIdChange",1);ne([Ae("APPLICATION_STATE.currentApplication",{immediate:!0})],G.prototype,"onGlobalApplicationChange",1);G=ne([be({components:{CrudTable:Ie,StructureItemModal:Ge,StructureDataViewModal:Pe,Dialog:Ue,Button:ce}})],G);const xi={class:"font-semibold"},Ci={class:"w-full text-center"},$i={class:"flex items-center justify-center"},ki={class:"flex items-center"},Ni={class:"flex justify-end gap-3"},Si={class:"flex items-center"},Ai={class:"flex justify-end gap-3"};function Ei(e,m,t,i,o,r){var b,c;const p=et,h=ce,g=ft,s=Ie,n=Ge,l=Pe,d=Ue;return a(),u("div",null,[R(s,{ref:"crudTable","data-source":e.dataSource,headers:e.structureTableHeaders,singleExpand:!1,search:e.searchText,"onUpdate:search":e.updateRouteQuery,onAddItem:e.onAddItem,onEditItem:e.onEditItem,onOnRowClick:e.handleRowClick,isShowAddNew:e.showNewStructureButton,createNewButtonText:e.newStructureButtonText,emptyStateText:"No structures yet for this project",rowHoverColor:"",class:"!text-sm"},{"item.name":B(({item:f})=>[y("span",xi,S(f.name),1)]),"item.created":B(({item:f})=>[y("span",null,S(e.DatetimeUtil.formatMonthDayYear(f.created)),1)]),"item.updated":B(({item:f})=>[y("span",null,S(e.DatetimeUtil.formatRelativeDate(f.updated)),1)]),"item.published":B(({item:f})=>[y("div",Ci,[R(p,{value:f.published?"Published":"Unpublished",severity:f.published?"success":"secondary",class:"px-2 py-1 text-sm",rounded:""},null,8,["value","severity"])])]),"item.description":B(({item:f})=>[y("span",null,S(f.description),1)]),"additional-actions":B(({item:f})=>[y("div",$i,[R(h,{icon:"pi pi-ellipsis-v",onClick:I(w=>e.toggleMenu(w,f,f.id),["stop"]),"aria-haspopup":"true","aria-controls":"action_menu_"+f.id,type:"button",severity:"secondary",variant:"text"},null,8,["onClick","aria-controls"]),R(g,{ref:w=>e.actionMenus[f.id]=w,model:e.getActionMenu(f),popup:!0,id:"action_menu_"+f.id},null,8,["model","id"])])]),_:1},8,["data-source","headers","search","onUpdate:search","onAddItem","onEditItem","onOnRowClick","isShowAddNew","createNewButtonText"]),e.showItemModal&&e.selectedStructure?(a(),ee(n,{key:0,item:e.selectedStructure,onClose:e.closeItemModal},null,8,["item","onClose"])):D("",!0),e.showModal&&e.selectedStructure?(a(),ee(l,{key:1,modelValue:e.showModal,"onUpdate:modelValue":m[0]||(m[0]=f=>e.showModal=f),title:((b=e.selectedStructure)==null?void 0:b.name)||"Data View","entity-props":{structureId:(c=e.selectedStructure)==null?void 0:c.id},onClose:e.closeModal},null,8,["modelValue","title","entity-props","onClose"])):D("",!0),R(d,{visible:e.showPublishModal,"onUpdate:visible":m[1]||(m[1]=f=>e.showPublishModal=f),modal:"",style:{width:"400px"},closable:!1},{header:B(()=>{var f,w,C;return[y("div",ki,[y("span",null,S(((f=e.selectedStructure)==null?void 0:f.name)||"Structure"),1),y("div",{class:J(["ml-2 px-3 py-1 rounded-full text-sm font-medium",(w=e.selectedStructure)!=null&&w.published?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"])},S((C=e.selectedStructure)!=null&&C.published?"Published":"Unpublished"),3)])]}),footer:B(()=>[y("div",Ni,[R(h,{label:"Cancel",severity:"secondary",onClick:e.closePublishModal,class:"px-4 py-2"},null,8,["onClick"]),R(h,{label:"Publish",onClick:e.publishFromModal,loading:e.isPublishing,class:"px-4 py-2"},null,8,["onClick","loading"])])]),default:B(()=>[m[3]||(m[3]=y("div",{class:"mb-6"},[y("p",{class:"text-gray-700"}," The structure must be published before it can contain data. Would you like to publish it? ")],-1))]),_:1,__:[3]},8,["visible"]),R(d,{visible:e.showUnpublishModal,"onUpdate:visible":m[2]||(m[2]=f=>e.showUnpublishModal=f),modal:"",style:{width:"450px"},closable:!1},{header:B(()=>{var f,w,C;return[y("div",Si,[y("span",null,S(((f=e.selectedStructure)==null?void 0:f.name)||"Structure"),1),y("div",{class:J(["ml-2 px-3 py-1 rounded-full text-sm font-medium",(w=e.selectedStructure)!=null&&w.published?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"])},S((C=e.selectedStructure)!=null&&C.published?"Published":"Unpublished"),3)])]}),footer:B(()=>[y("div",Ai,[R(h,{label:"Cancel",severity:"secondary",onClick:e.closeUnpublishModal,class:"px-4 py-2"},null,8,["onClick"]),R(h,{label:"Unpublish",severity:"danger",onClick:e.unpublishFromModal,loading:e.isPublishing,class:"px-4 py-2"},null,8,["onClick","loading"])])]),default:B(()=>[m[4]||(m[4]=y("div",{class:"mb-6"},[y("div",{class:"flex items-start gap-3"},[y("div",{class:"flex-shrink-0"},[y("svg",{class:"w-6 h-6 text-red-600 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[y("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})])]),y("div",null,[y("p",{class:"text-gray-700 font-medium mb-2"},"Are you sure you want to unpublish this structure?"),y("p",{class:"text-gray-600 text-sm"}," All data saved under this structure will be permanently deleted. This action cannot be undone. ")])])],-1))]),_:1,__:[4]},8,["visible"])])}const Ii=ve(G,[["render",Ei],["__scopeId","data-v-e5490cec"]]);export{Ii as P,Ge as S,Pe as _,et as s};
//# sourceMappingURL=ProjectStructuresTable-Ba6lP25Y.js.map
